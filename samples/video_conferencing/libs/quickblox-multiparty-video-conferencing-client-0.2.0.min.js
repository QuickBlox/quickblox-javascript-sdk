!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.QBVideoConferencingClient=e()}}(function(){var e;return function e(r,n,t){function o(a,s){if(!n[a]){if(!r[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[a]={exports:{}};r[a][0].call(d.exports,function(e){var n=r[a][1][e];return o(n||e)},d,d.exports,e,r,n,t)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,r,n){var t={EventEmitter:e("./lib/BaseEventEmitter"),EmitterSubscription:e("./lib/EmitterSubscription")};r.exports=t},{"./lib/BaseEventEmitter":2,"./lib/EmitterSubscription":3}],2:[function(e,r,n){(function(n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var o=e("./EmitterSubscription"),i=e("./EventSubscriptionVendor"),a=e("fbjs/lib/emptyFunction"),s=e("fbjs/lib/invariant"),c=function(){function e(){t(this,e),this._subscriber=new i,this._currentSubscription=null}return e.prototype.addListener=function(e,r,n){return this._subscriber.addSubscription(e,new o(this._subscriber,r,n))},e.prototype.once=function(e,r,n){var t=this;return this.addListener(e,function(){t.removeCurrentListener(),r.apply(n,arguments)})},e.prototype.removeAllListeners=function(e){this._subscriber.removeAllSubscriptions(e)},e.prototype.removeCurrentListener=function(){this._currentSubscription||("production"!==n.env.NODE_ENV?s(!1,"Not in an emitting cycle; there is no current subscription"):s(!1)),this._subscriber.removeSubscription(this._currentSubscription)},e.prototype.listeners=function(e){var r=this._subscriber.getSubscriptionsForType(e);return r?r.filter(a.thatReturnsTrue).map(function(e){return e.listener}):[]},e.prototype.emit=function(e){var r=this._subscriber.getSubscriptionsForType(e);if(r){for(var n=Object.keys(r),t=0;t<n.length;t++){var o=n[t],i=r[o];i&&(this._currentSubscription=i,this.__emitToSubscription.apply(this,[i].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},e.prototype.__emitToSubscription=function(e,r){var n=Array.prototype.slice.call(arguments,2);e.listener.apply(e.context,n)},e}();r.exports=c}).call(this,e("_process"))},{"./EmitterSubscription":3,"./EventSubscriptionVendor":5,_process:8,"fbjs/lib/emptyFunction":6,"fbjs/lib/invariant":7}],3:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function o(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var i=e("./EventSubscription"),a=function(e){function r(n,o,i){t(this,r),e.call(this,n),this.listener=o,this.context=i}return o(r,e),r}(i);r.exports=a},{"./EventSubscription":4}],4:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(r){t(this,e),this.subscriber=r}return e.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},e}();r.exports=o},{}],5:[function(e,r,n){(function(n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var o=e("fbjs/lib/invariant"),i=function(){function e(){t(this,e),this._subscriptionsForType={},this._currentSubscription=null}return e.prototype.addSubscription=function(e,r){r.subscriber!==this&&("production"!==n.env.NODE_ENV?o(!1,"The subscriber of the subscription is incorrectly set."):o(!1)),this._subscriptionsForType[e]||(this._subscriptionsForType[e]=[]);var t=this._subscriptionsForType[e].length;return this._subscriptionsForType[e].push(r),r.eventType=e,r.key=t,r},e.prototype.removeAllSubscriptions=function(e){void 0===e?this._subscriptionsForType={}:delete this._subscriptionsForType[e]},e.prototype.removeSubscription=function(e){var r=e.eventType,n=e.key,t=this._subscriptionsForType[r];t&&delete t[n]},e.prototype.getSubscriptionsForType=function(e){return this._subscriptionsForType[e]},e}();r.exports=i}).call(this,e("_process"))},{_process:8,"fbjs/lib/invariant":7}],6:[function(e,r,n){"use strict";function t(e){return function(){return e}}var o=function(){};o.thatReturns=t,o.thatReturnsFalse=t(!1),o.thatReturnsTrue=t(!0),o.thatReturnsNull=t(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},r.exports=o},{}],7:[function(e,r,n){(function(e){"use strict";function n(e,r,n,o,i,a,s,c){if(t(r),!e){var u;if(void 0===r)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[n,o,i,a,s,c],l=0;u=new Error(r.replace(/%s/g,function(){return d[l++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}}var t=function(e){};"production"!==e.env.NODE_ENV&&(t=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),r.exports=n}).call(this,e("_process"))},{_process:8}],8:[function(e,r,n){function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===t||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(r){try{return l.call(null,e,0)}catch(r){return l.call(this,e,0)}}}function a(e){if(f===clearTimeout)return clearTimeout(e);if((f===o||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(r){try{return f.call(null,e)}catch(r){return f.call(this,e)}}}function s(){g&&m&&(g=!1,m.length?p=m.concat(p):b=-1,p.length&&c())}function c(){if(!g){var e=i(s);g=!0;for(var r=p.length;r;){for(m=p,p=[];++b<r;)m&&m[b].run();b=-1,r=p.length}m=null,g=!1,a(e)}}function u(e,r){this.fun=e,this.array=r}function d(){}var l,f,v=r.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:t}catch(e){l=t}try{f="function"==typeof clearTimeout?clearTimeout:o}catch(e){f=o}}();var m,p=[],g=!1,b=-1;v.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];p.push(new u(e,r)),1!==p.length||g||i(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={},v.on=d,v.addListener=d,v.once=d,v.off=d,v.removeListener=d,v.removeAllListeners=d,v.emit=d,v.prependListener=d,v.prependOnceListener=d,v.listeners=function(e){return[]},v.binding=function(e){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(e){throw new Error("process.chdir is not supported")},v.umask=function(){return 0}},{}],9:[function(r,n,t){!function(r,o){"object"==typeof t&&void 0!==n?n.exports=o():"function"==typeof e&&e.amd?e(o):r.Janus=o()}(this,function(){function e(r){function n(){if(null!=K){if(e.debug("Long poll..."),!Y)return void e.warn("Is the gateway down? (connected=false)");var o=U+"/"+K+"?rid="+(new Date).getTime();void 0!==z&&null!==z&&(o=o+"&maxev="+z),null!==H&&void 0!==H&&(o=o+"&token="+H),null!==Q&&void 0!==Q&&(o=o+"&apisecret="+Q),e.httpAPICall(o,{verb:"GET",withCredentials:B,success:t,timeout:6e4,error:function(t,o){if(e.error(t+": "+o),++$>3)return Y=!1,void r.error("Lost connection to the gateway (is it down?)");n()}})}}function t(r,o){if($=0,j||void 0===v||null===v||!0===o||setTimeout(n,200),j||!e.isArray(r)){if("keepalive"===r.janus)return void e.vdebug("Got a keepalive on session "+v);if("ack"!==r.janus)if("success"!==r.janus){if("webrtcup"===r.janus){e.debug("Got a webrtcup event on session "+v),e.debug(r);var i=r.sender;if(void 0===i||null===i)return void e.warn("Missing sender...");var a=X[i];return void 0===a||null===a?void e.debug("This handle is not attached to this session"):void a.webrtcState(!0)}if("hangup"===r.janus){e.debug("Got a hangup event on session "+v),e.debug(r);var i=r.sender;if(void 0===i||null===i)return void e.warn("Missing sender...");var a=X[i];if(void 0===a||null===a)return void e.debug("This handle is not attached to this session");a.webrtcState(!1,r.reason),a.hangup()}else if("detached"===r.janus){e.debug("Got a detached event on session "+v),e.debug(r);var i=r.sender;if(void 0===i||null===i)return void e.warn("Missing sender...");var a=X[i];if(void 0===a||null===a)return;a.detached=!0,a.ondetached(),a.detach()}else if("media"===r.janus){e.debug("Got a media event on session "+v),e.debug(r);var i=r.sender;if(void 0===i||null===i)return void e.warn("Missing sender...");var a=X[i];if(void 0===a||null===a)return void e.debug("This handle is not attached to this session");a.mediaState(r.type,r.receiving)}else if("slowlink"===r.janus){e.debug("Got a slowlink event on session "+v),e.debug(r);var i=r.sender;if(void 0===i||null===i)return void e.warn("Missing sender...");var a=X[i];if(void 0===a||null===a)return void e.debug("This handle is not attached to this session");a.slowLink(r.uplink,r.nacks)}else{if("error"===r.janus){e.error("Ooops: "+r.error.code+" "+r.error.reason),e.debug(r);var s=r.transaction;if(null!==s&&void 0!==s){var c=ee[s];null!==c&&void 0!==c&&c(r),delete ee[s]}return}if("event"===r.janus){e.debug("Got a plugin event on session "+v),e.debug(r);var i=r.sender;if(void 0===i||null===i)return void e.warn("Missing sender...");var u=r.plugindata;if(void 0===u||null===u)return void e.warn("Missing plugindata...");e.debug("  -- Event is coming from "+i+" ("+u.plugin+")");var d=u.data;e.debug(d);var a=X[i];if(void 0===a||null===a)return void e.warn("This handle is not attached to this session");var l=r.jsep;void 0!==l&&null!==l&&(e.debug("Handling SDP as well..."),e.debug(l));var f=a.onmessage;null!==f&&void 0!==f?(e.debug("Notifying application..."),f(d,l)):e.debug("No provided notification callback")}else if("timeout"===r.janus){var v=r.session_id,m=e.sessions[v];m&&m.timeoutSessionCallback()}else e.warn("Unkown message/event  '"+r.janus+"' on session "+v),e.debug(r)}}else{e.debug("Got a success on session "+v),e.debug(r);var s=r.transaction;if(null!==s&&void 0!==s){var c=ee[s];null!==c&&void 0!==c&&c(r),delete ee[s]}}else{e.debug("Got an ack on session "+v),e.debug(r);var s=r.transaction;if(null!==s&&void 0!==s){var c=ee[s];null!==c&&void 0!==c&&c(r),delete ee[s]}}}else for(var p=0;p<r.length;p++)t(r[p],!0)}function o(){if(null!==U&&j&&Y){_=setTimeout(o,3e4);var r={janus:"keepalive",session_id:K,transaction:e.randomString(12)};null!==H&&void 0!==H&&(r.token=H),null!==Q&&void 0!==Q&&(r.apisecret=Q),M.send(JSON.stringify(r))}}function i(a){var s=e.randomString(12),c={janus:"create",transaction:s};if(null!==H&&void 0!==H&&(c.token=H),null!==Q&&void 0!==Q&&(c.apisecret=Q),null===U&&e.isArray(L)&&(U=L[N],0===U.indexOf("ws")?(j=!0,e.log("Server #"+(N+1)+": trying WebSockets to contact Janus ("+U+")")):(j=!1,e.log("Server #"+(N+1)+": trying REST API to contact Janus ("+U+")"))),j){M=e.newWebSocket(U,"janus-protocol"),F={error:function(){if(console.warn("WS error"),e.error("Error connecting to the Janus WebSockets server... "+U),e.isArray(L))return++N==L.length?void a.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(U=null,void setTimeout(function(){i(a)},200));a.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){console.warn("WS connected"),ee[s]=function(r){if(e.debug(r),"success"!==r.janus)return e.error("Ooops: "+r.error.code+" "+r.error.reason),void a.error(r.error.reason);_=setTimeout(o,3e4),Y=!0,K=r.data.id,e.log("Created session: "+K),e.sessions[K]=Z,a.success()},M.send(JSON.stringify(c))},message:function(e){t(JSON.parse(e.data))},close:function(){null!==U&&Y&&(Y=!1,console.warn("WS close"),r.error("Lost connection to the gateway (is it down?)"))}};for(var u in F)M.addEventListener(u,F[u])}else e.httpAPICall(U,{verb:"POST",withCredentials:B,body:c,success:function(r){if(e.debug(r),"success"!==r.janus)return e.error("Ooops: "+r.error.code+" "+r.error.reason),void a.error(r.error.reason);Y=!0,K=r.data.id,e.log("Created session: "+K),e.sessions[K]=Z,n(),a.success()},error:function(r,n){if(e.error(r+": "+n),e.isArray(L))return++N==L.length?void a.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(U=null,void setTimeout(function(){i(a)},200));""===n?a.error(r+": Is the gateway down?"):a.error(r+": "+n)}})}function a(n){n=n||{},n.success="function"==typeof n.success?n.success:e.noop;var t=!0;if(void 0!==n.asyncRequest&&null!==n.asyncRequest&&(t=!0===n.asyncRequest),e.log("Destroying session "+K+" (async="+t+")"),!Y)return e.warn("Is the gateway down? (connected=false)"),void n.success();if(void 0===K||null===K)return e.warn("No session to destroy"),n.success(),void r.destroyed();delete e.sessions[K];var o={janus:"destroy",transaction:e.randomString(12)};if(null!==H&&void 0!==H&&(o.token=H),null!==Q&&void 0!==Q&&(o.apisecret=Q),j){o.session_id=K;var i=function(){for(var e in F)M.removeEventListener(e,F[e]);M.removeEventListener("message",a),M.removeEventListener("error",s),_&&clearTimeout(_),M.close()},a=function(e){var t=JSON.parse(e.data);t.session_id==o.session_id&&t.transaction==o.transaction&&(i(),n.success(),r.destroyed())},s=function(e){i(),n.error("Failed to destroy the gateway: Is the gateway down?"),r.destroyed()};return M.addEventListener("message",a),M.addEventListener("error",s),void M.send(JSON.stringify(o))}e.httpAPICall(U+"/"+K,{verb:"POST",async:t,withCredentials:B,body:o,success:function(t){e.log("Destroyed session:"),e.debug(t),K=null,Y=!1,"success"!==t.janus&&e.error("Ooops: "+t.error.code+" "+t.error.reason),n.success(),r.destroyed()},error:function(t,o){e.error(t+": "+o),K=null,Y=!1,n.success(),r.destroyed()}})}function s(r){if(r=r||{},r.success="function"==typeof r.success?r.success:e.noop,r.error="function"==typeof r.error?r.error:e.noop,r.consentDialog="function"==typeof r.consentDialog?r.consentDialog:e.noop,r.iceState="function"==typeof r.iceState?r.iceState:e.noop,r.mediaState="function"==typeof r.mediaState?r.mediaState:e.noop,r.webrtcState="function"==typeof r.webrtcState?r.webrtcState:e.noop,r.slowLink="function"==typeof r.slowLink?r.slowLink:e.noop,r.onmessage="function"==typeof r.onmessage?r.onmessage:e.noop,r.onlocalstream="function"==typeof r.onlocalstream?r.onlocalstream:e.noop,r.onremotestream="function"==typeof r.onremotestream?r.onremotestream:e.noop,r.ondata="function"==typeof r.ondata?r.ondata:e.noop,r.ondataopen="function"==typeof r.ondataopen?r.ondataopen:e.noop,r.oncleanup="function"==typeof r.oncleanup?r.oncleanup:e.noop,r.ondetached="function"==typeof r.ondetached?r.ondetached:e.noop,!Y)return e.warn("Is the gateway down? (connected=false)"),void r.error("Is the gateway down? (connected=false)");var n=r.plugin;if(void 0===n||null===n)return e.error("Invalid plugin"),void r.error("Invalid plugin");var t=r.opaqueId,o=e.randomString(12),i={janus:"attach",plugin:n,opaque_id:t,transaction:o};if(null!==H&&void 0!==H&&(i.token=H),null!==Q&&void 0!==Q&&(i.apisecret=Q),"chrome"!=e.webRTCAdapter.browserDetails.browser&&"firefox"!=e.webRTCAdapter.browserDetails.browser&&"safari"!=e.webRTCAdapter.browserDetails.browser||(i["force-bundle"]=!0,i["force-rtcp-mux"]=!0),j)return ee[o]=function(t){if(e.debug(t),"success"!==t.janus)return e.error("Ooops: "+t.error.code+" "+t.error.reason),void r.error("Ooops: "+t.error.code+" "+t.error.reason);var o=t.data.id;e.log("Created handle: "+o);var i={session:Z,plugin:n,id:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return n},getVolume:function(){return w(o)},isAudioMuted:function(){return y(o,!1)},muteAudio:function(){return S(o,!1,!0)},unmuteAudio:function(){return S(o,!1,!1)},isVideoMuted:function(){return y(o,!0)},muteVideo:function(){return S(o,!0,!0)},unmuteVideo:function(){return S(o,!0,!1)},getBitrate:function(){return k(o)},send:function(e){c(o,e)},data:function(e){d(o,e)},dtmf:function(e){l(o,e)},consentDialog:r.consentDialog,iceState:r.iceState,mediaState:r.mediaState,webrtcState:r.webrtcState,slowLink:r.slowLink,onmessage:r.onmessage,createOffer:function(e){m(o,e)},createAnswer:function(e){m(o,e)},handleRemoteJsep:function(e){p(o,e)},onlocalstream:r.onlocalstream,onremotestream:r.onremotestream,ondata:r.ondata,ondataopen:r.ondataopen,oncleanup:r.oncleanup,ondetached:r.ondetached,hangup:function(e){T(o,!0===e)},detach:function(e){f(o,e)}};X[o]=i,r.success(i)},i.session_id=K,void M.send(JSON.stringify(i));e.httpAPICall(U+"/"+K,{verb:"POST",withCredentials:B,body:i,success:function(t){if(e.debug(t),"success"!==t.janus)return e.error("Ooops: "+t.error.code+" "+t.error.reason),void r.error("Ooops: "+t.error.code+" "+t.error.reason);var o=t.data.id;e.log("Created handle: "+o);var i={session:Z,plugin:n,id:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return n},getVolume:function(){return w(o)},isAudioMuted:function(){return y(o,!1)},muteAudio:function(){return S(o,!1,!0)},unmuteAudio:function(){return S(o,!1,!1)},isVideoMuted:function(){return y(o,!0)},muteVideo:function(){return S(o,!0,!0)},unmuteVideo:function(){return S(o,!0,!1)},getBitrate:function(){return k(o)},send:function(e){c(o,e)},data:function(e){d(o,e)},dtmf:function(e){l(o,e)},consentDialog:r.consentDialog,iceState:r.iceState,mediaState:r.mediaState,webrtcState:r.webrtcState,slowLink:r.slowLink,onmessage:r.onmessage,createOffer:function(e){m(o,e)},createAnswer:function(e){m(o,e)},handleRemoteJsep:function(e){p(o,e)},onlocalstream:r.onlocalstream,onremotestream:r.onremotestream,ondata:r.ondata,ondataopen:r.ondataopen,oncleanup:r.oncleanup,ondetached:r.ondetached,hangup:function(e){T(o,!0===e)},detach:function(e){f(o,e)}};X[o]=i,r.success(i)},error:function(r,n){e.error(r+": "+n)}})}function c(r,n){if(n=n||{},n.success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop,!Y)return e.warn("Is the gateway down? (connected=false)"),void n.error("Is the gateway down? (connected=false)");var t=n.message,o=n.jsep,i=e.randomString(12),a={janus:"message",body:t,transaction:i};if(null!==H&&void 0!==H&&(a.token=H),null!==Q&&void 0!==Q&&(a.apisecret=Q),null!==o&&void 0!==o&&(a.jsep=o),e.debug("Sending message to plugin (handle="+r+"):"),e.debug(a),j)return a.session_id=K,a.handle_id=r,ee[i]=function(r){if(e.debug("Message sent!"),e.debug(r),"success"===r.janus){var t=r.plugindata;if(void 0===t||null===t)return e.warn("Request succeeded, but missing plugindata..."),void n.success();e.log("Synchronous transaction successful ("+t.plugin+")");var o=t.data;return e.debug(o),void n.success(o)}if("ack"!==r.janus)return void(void 0!==r.error&&null!==r.error?(e.error("Ooops: "+r.error.code+" "+r.error.reason),n.error(r.error.code+" "+r.error.reason)):(e.error("Unknown error"),n.error("Unknown error")));n.success()},void M.send(JSON.stringify(a));e.httpAPICall(U+"/"+K+"/"+r,{verb:"POST",withCredentials:B,body:a,success:function(r){if(e.debug("Message sent!"),e.debug(r),"success"===r.janus){var t=r.plugindata;if(void 0===t||null===t)return e.warn("Request succeeded, but missing plugindata..."),void n.success();e.log("Synchronous transaction successful ("+t.plugin+")");var o=t.data;return e.debug(o),void n.success(o)}if("ack"!==r.janus)return void(void 0!==r.error&&null!==r.error?(e.error("Ooops: "+r.error.code+" "+r.error.reason),n.error(r.error.code+" "+r.error.reason)):(e.error("Unknown error"),n.error("Unknown error")));n.success()},error:function(r,t){e.error(r+": "+t),n.error(r+": "+t)}})}function u(r,n){if(!Y)return void e.warn("Is the gateway down? (connected=false)");var t={janus:"trickle",candidate:n,transaction:e.randomString(12)};if(null!==H&&void 0!==H&&(t.token=H),null!==Q&&void 0!==Q&&(t.apisecret=Q),e.vdebug("Sending trickle candidate (handle="+r+"):"),e.vdebug(t),j)return t.session_id=K,t.handle_id=r,void M.send(JSON.stringify(t));e.httpAPICall(U+"/"+K+"/"+r,{verb:"POST",withCredentials:B,body:t,success:function(r){if(e.vdebug("Candidate sent!"),e.vdebug(r),"ack"!==r.janus)return void e.error("Ooops: "+r.error.code+" "+r.error.reason)},error:function(r,n){e.error(r+": "+n)}})}function d(r,n){n=n||{},n.success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop;var t=X[r];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var o=t.webrtcStuff,i=n.text;if(null===i||void 0===i)return e.warn("Invalid text"),void n.error("Invalid text");e.log("Sending string on data channel: "+i),o.dataChannel.send(i),n.success()}function l(r,n){n=n||{},n.success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop;var t=X[r];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var o=t.webrtcStuff;if(null===o.dtmfSender||void 0===o.dtmfSender){if(void 0!==o.myStream&&null!==o.myStream){var i=o.myStream.getAudioTracks();if(null!==i&&void 0!==i&&i.length>0){var a=i[0];o.dtmfSender=o.pc.createDTMFSender(a),e.log("Created DTMF Sender"),o.dtmfSender.ontonechange=function(r){e.debug("Sent DTMF tone: "+r.tone)}}}if(null===o.dtmfSender||void 0===o.dtmfSender)return e.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration")}var s=n.dtmf;if(null===s||void 0===s)return e.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");var c=s.tones;if(null===c||void 0===c)return e.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");var u=s.duration;null!==u&&void 0!==u||(u=500);var d=s.gap;null!==d&&void 0!==d||(d=50),e.debug("Sending DTMF string "+c+" (duration "+u+"ms, gap "+d+"ms)"),o.dtmfSender.insertDTMF(c,u,d)}function f(r,n){n=n||{},n.success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop;var t=!0;if(void 0!==n.asyncRequest&&null!==n.asyncRequest&&(t=!0===n.asyncRequest),e.log("Destroying handle "+r+" (async="+t+")"),T(r),X[r].detached)return delete X[r],void n.success();if(!Y)return e.warn("Is the gateway down? (connected=false)"),void n.error("Is the gateway down? (connected=false)");var o={janus:"detach",transaction:e.randomString(12)};if(null!==H&&void 0!==H&&(o.token=H),null!==Q&&void 0!==Q&&(o.apisecret=Q),j)return o.session_id=K,o.handle_id=r,M.send(JSON.stringify(o)),delete X[r],void n.success();e.httpAPICall(U+"/"+K+"/"+r,{verb:"POST",async:t,withCredentials:B,body:o,success:function(t){e.log("Destroyed handle:"),e.debug(t),"success"!==t.janus&&e.error("Ooops: "+t.error.code+" "+t.error.reason),delete X[r],n.success()},error:function(t,o){e.error(t+": "+o),delete X[r],n.success()}})}function v(r,n,t,o,i){console.warn("streamsDone",t);var a=X[r];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return e.warn("Invalid handle"),void o.error("Invalid handle");var s=a.webrtcStuff;if(e.debug("streamsDone:",i),i&&(e.debug("  -- Audio tracks:",i.getAudioTracks()),e.debug("  -- Video tracks:",i.getVideoTracks())),t.update&&!s.streamExternal){if((t.removeAudio||t.replaceAudio)&&(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length&&(e.log("Removing audio track:",s.myStream.getAudioTracks()[0]),s.myStream.removeTrack(s.myStream.getAudioTracks()[0])),s.pc.getSenders()&&s.pc.getSenders().length))for(var c in s.pc.getSenders()){var d=s.pc.getSenders()[c];d&&d.track&&"audio"===d.track.kind&&(e.log("Removing audio sender:",d),s.pc.removeTrack(d))}if((t.removeVideo||t.replaceVideo)&&(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length&&(e.log("Removing video track:",s.myStream.getVideoTracks()[0]),s.myStream.removeTrack(s.myStream.getVideoTracks()[0])),s.pc.getSenders()&&s.pc.getSenders().length))for(var c in s.pc.getSenders()){var d=s.pc.getSenders()[c];d&&d.track&&"video"===d.track.kind&&(e.log("Removing video sender:",d),s.pc.removeTrack(d))}}var l=!1;if(s.myStream&&t.update&&!s.streamExternal?((!t.update&&R(t)||t.update&&(t.addAudio||t.replaceAudio))&&i.getAudioTracks()&&i.getAudioTracks().length&&(e.log("Adding audio track:",i.getAudioTracks()[0]),s.myStream.addTrack(i.getAudioTracks()[0]),s.pc.addTrack(i.getAudioTracks()[0],i)),(!t.update&&x(t)||t.update&&(t.addVideo||t.replaceVideo))&&i.getVideoTracks()&&i.getVideoTracks().length&&(e.log("Adding video track:",i.getVideoTracks()[0]),s.myStream.addTrack(i.getVideoTracks()[0]),s.pc.addTrack(i.getVideoTracks()[0],i))):(s.myStream=i,l=!0),!s.pc){var f={iceServers:J,iceTransportPolicy:q,bundlePolicy:W},v={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===G&&v.optional.push({googIPv6:!0}),o.rtcConstraints&&"object"==typeof o.rtcConstraints){e.debug("Adding custom PeerConnection constraints:",o.rtcConstraints);for(var m in o.rtcConstraints)v.optional.push(o.rtcConstraints[m])}"edge"===e.webRTCAdapter.browserDetails.browser&&(f.bundlePolicy="max-bundle"),e.log("Creating PeerConnection"),e.debug(v),s.pc=new RTCPeerConnection(f,v),e.debug(s.pc),s.pc.getStats&&(s.volume.value=0,s.bitrate.value="0 kbits/sec"),e.log("Preparing local SDP and gathering candidates (trickle="+s.trickle+")"),s.pc.oniceconnectionstatechange=function(e){s.pc&&a.iceState(s.pc.iceConnectionState)},s.pc.onicecandidate=function(n){if(null==n.candidate||"edge"===e.webRTCAdapter.browserDetails.browser&&n.candidate.candidate.indexOf("endOfCandidates")>0)e.log("End of candidates."),s.iceDone=!0,!0===s.trickle?u(r,{completed:!0}):h(r,o);else{var t={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};!0===s.trickle&&u(r,t)}},s.pc.ontrack=function(r){e.log("Handling Remote Track"),e.debug(r),r.streams&&(s.remoteStream=r.streams[0],a.onremotestream(s.remoteStream),r.track&&!r.track.onended&&(e.log("Adding onended callback to track:",r.track),r.track.onended=function(r){e.log("Remote track removed:",r),s.remoteStream&&(s.remoteStream.removeTrack(r.target),a.onremotestream(s.remoteStream))}))}}if(l&&null!==i&&void 0!==i&&(e.log("Adding local stream"),i.getTracks().forEach(function(e){s.pc.addTrack(e,i)})),V(t)&&!s.dataChannel){e.log("Creating data channel");var p=function(r){e.log("Received message on data channel: "+r.data),a.ondata(r.data)},w=function(){var r=null!==s.dataChannel?s.dataChannel.readyState:"null";e.log("State change on data channel: "+r),"open"===r&&a.ondataopen()},y=function(r){e.error("Got error on data channel:",r)};s.dataChannel=s.pc.createDataChannel("JanusDataChannel",{ordered:!1}),s.dataChannel.onmessage=p,s.dataChannel.onopen=w,s.dataChannel.onclose=w,s.dataChannel.onerror=y}s.myStream&&a.onlocalstream(s.myStream),null===n||void 0===n?g(r,t,o):s.pc.setRemoteDescription(new RTCSessionDescription(n),function(){e.log("Remote description accepted!"),b(r,t,o)},o.error)}function m(r,n){function t(e,t){s.consentDialog(!1),e?n.error({code:e.code,name:e.name,message:e.message}):v(r,i,a,n,t)}function o(r,n,t){e.log("Adding media constraint (screen capture)"),e.debug(r),navigator.mediaDevices.getUserMedia(r).then(function(e){t?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(r){e.addTrack(r.getAudioTracks()[0]),n(null,e)}):n(null,e)}).catch(function(e){s.consentDialog(!1),n(e)})}n=n||{},n.success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:C;var i=n.jsep;n.media=n.media||{audio:!0,video:!0};var a=n.media,s=X[r];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var c=s.webrtcStuff;if(void 0===c.pc||null===c.pc)a.update=!1;else if(void 0!==c.pc&&null!==c.pc)if(e.log("Updating existing media session"),a.update=!0,null!==n.stream&&void 0!==n.stream)n.stream!==c.myStream&&e.log("Renegotiation involves a new external stream");else{if(a.addAudio){if(a.replaceAudio=!1,a.removeAudio=!1,a.audioSend=!0,c.myStream&&c.myStream.getAudioTracks()&&c.myStream.getAudioTracks().length)return e.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else a.removeAudio?(a.replaceAudio=!1,a.addAudio=!1,a.audioSend=!1):a.replaceAudio&&(a.addAudio=!1,a.removeAudio=!1,a.audioSend=!0);if(null===c.myStream||void 0===c.myStream?(a.replaceAudio&&(a.replaceAudio=!1,a.addAudio=!0,a.audioSend=!0),R(a)&&(a.addAudio=!0)):null!==c.myStream.getAudioTracks()&&void 0!==c.myStream.getAudioTracks()&&0!==c.myStream.getAudioTracks().length||(a.replaceAudio&&(a.replaceAudio=!1,a.addAudio=!0,a.audioSend=!0),R(a)&&(a.addAudio=!0)),a.addVideo){if(a.replaceVideo=!1,a.removeVideo=!1,a.videoSend=!0,c.myStream&&c.myStream.getVideoTracks()&&c.myStream.getVideoTracks().length)return e.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else a.removeVideo?(a.replaceVideo=!1,a.addVideo=!1,a.videoSend=!1):a.replaceVideo&&(a.addVideo=!1,a.removeVideo=!1,a.videoSend=!0);null===c.myStream||void 0===c.myStream?(a.replaceVideo&&(a.replaceVideo=!1,a.addVideo=!0,a.videoSend=!0),x(a)&&(a.addVideo=!0)):null!==c.myStream.getVideoTracks()&&void 0!==c.myStream.getVideoTracks()&&0!==c.myStream.getVideoTracks().length||(a.replaceVideo&&(a.replaceVideo=!1,a.addVideo=!0,a.videoSend=!0),x(a)&&(a.addVideo=!0)),a.addData&&(a.data=!0)}if(c.trickle=P(n.trickle),null!==n.stream&&void 0!==n.stream){var u=n.stream;if(e.log("MediaStream provided by the application"),e.debug(u),a.update&&c.myStream&&c.myStream!==n.stream&&!c.streamExternal){try{var d=c.myStream.getTracks();for(var l in d){var f=d[l];e.log(f),null!==f&&void 0!==f&&f.stop()}}catch(e){}c.myStream=null}return c.streamExternal=!0,void v(r,i,a,n,u)}if(R(a)||x(a)){var m={mandatory:{},optional:[]};s.consentDialog(!0);var p=R(a);!0===p&&void 0!=a&&null!=a&&"object"==typeof a.audio&&(p=a.audio);var g=x(a);if(!0===g&&void 0!=a&&null!=a){if(!(!0===n.simulcast)||i||void 0!==a.video&&!1!==a.video||(a.video="hires"),a.video&&"screen"!=a.video&&"window"!=a.video){var b=0,h=0,w=0;if("lowres"===a.video)h=240,w=240,b=320;else if("lowres-16:9"===a.video)h=180,w=180,b=320;else if("hires"===a.video||"hires-16:9"===a.video){if(h=720,w=720,b=1280,navigator.mozGetUserMedia){var y=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);y<38&&(e.warn(a.video+" unsupported, falling back to stdres (old Firefox)"),h=480,w=480,b=640)}}else"stdres"===a.video?(h=480,w=480,b=640):"stdres-16:9"===a.video?(h=360,w=360,b=640):(e.log("Default video setting is stdres 4:3"),h=480,w=480,b=640);if(e.log("Adding media constraint:",a.video),navigator.mozGetUserMedia){var y=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);y<38?g={require:["height","width"],height:{max:w,min:h},width:{max:b,min:b}}:(g={height:{ideal:h},width:{ideal:b}},a.videoFrameRate&&(g.frameRate=a.videoFrameRate))}else g={height:h,width:b},a.videoFrameRate&&(g.frameRate=a.videoFrameRate);"object"==typeof a.video&&(g=a.video),e.debug(g)}else if("screen"===a.video||"window"===a.video){
if(a.screenshareFrameRate||(a.screenshareFrameRate=3),"https:"!==window.location.protocol)return e.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),s.consentDialog(!1),void n.error("Screen sharing only works on HTTPS, try the https:// version of this page");var S={};if("chrome"===e.webRTCAdapter.browserDetails.browser){var k=e.webRTCAdapter.browserDetails.version,T=33;if(window.navigator.userAgent.match("Linux")&&(T=35),k>=26&&k<=T)m={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:a.screenshareFrameRate,maxFrameRate:a.screenshareFrameRate,chromeMediaSource:"screen"}},audio:R(a)},o(m,t);else{var A=window.setTimeout(function(){return O=new Error("NavigatorUserMediaError"),O.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',s.consentDialog(!1),n.error(O)},1e3);S[A]=[t,null],window.postMessage({type:"janusGetScreen",id:A},"*")}}else if(window.navigator.userAgent.match("Firefox")){var I=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);if(!(I>=33)){var O=new Error("NavigatorUserMediaError");return O.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",s.consentDialog(!1),void n.error(O)}m={video:{mozMediaSource:a.video,mediaSource:a.video},audio:R(a)},o(m,function(e,r){if(t(e,r),!e)var n=r.currentTime,o=window.setInterval(function(){r||window.clearInterval(o),r.currentTime==n&&(window.clearInterval(o),r.onended&&r.onended()),n=r.currentTime},500)})}return void window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("janusGotScreen"==e.data.type&&S[e.data.id]){var r=S[e.data.id],t=r[0];if(delete S[e.data.id],""===e.data.sourceId){var i=new Error("NavigatorUserMediaError");i.name="You cancelled the request for permission, giving up...",s.consentDialog(!1),n.error(i)}else m={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:a.screenshareFrameRate,maxFrameRate:a.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},m.video.mandatory.chromeMediaSourceId=e.data.sourceId,o(m,t,R(a))}else"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})}}null!==a&&void 0!==a&&"screen"===a.video||navigator.mediaDevices.enumerateDevices().then(function(t){var o=t.some(function(e){return"audioinput"===e.kind}),c=t.some(function(e){return"videoinput"===e.kind}),u=R(a),d=x(a),l=D(a),f=E(a);if(u||d||l||f){var m=!!u&&o,b=!!d&&c;if(!m&&!b)return s.consentDialog(!1),n.error("No capture device found"),!1;if(!m&&l)return s.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!b&&f)return s.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!o&&p,video:!!c&&g}).then(function(t){e.debug("Video height: "+t.getVideoTracks()[0].getSettings().height),e.debug("Video width: "+t.getVideoTracks()[0].getSettings().width),e.debug("Video framerate: "+t.getVideoTracks()[0].getSettings().frameRate),s.consentDialog(!1),v(r,i,a,n,t)}).catch(function(e){s.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){s.consentDialog(!1),n.error("enumerateDevices error",e)})}else v(r,i,a,n)}function p(r,n){n=n||{},n.success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:C;var t=n.jsep,o=X[r];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var i=o.webrtcStuff;if(void 0!==t&&null!==t){if(null===i.pc)return e.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");i.pc.setRemoteDescription(new RTCSessionDescription(t),function(){e.log("Remote description accepted!"),n.success()},n.error)}else n.error("Invalid JSEP")}function g(r,n,t){console.warn("createOffer:",n),t=t||{},t.success="function"==typeof t.success?t.success:e.noop,t.error="function"==typeof t.error?t.error:e.noop;var o=X[r];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return e.warn("Invalid handle"),void t.error("Invalid handle");var i=o.webrtcStuff,a=!0===t.simulcast;a?e.log("Creating offer (iceDone="+i.iceDone+", simulcast="+a+")"):e.log("Creating offer (iceDone="+i.iceDone+")");var s={offerToReceiveAudio:I(n),offerToReceiveVideo:O(n)};!0===t.iceRestart&&(s.iceRestart=!0),e.debug(s);var c=x(n);if(c&&a&&"firefox"===e.webRTCAdapter.browserDetails.browser){e.log("Enabling Simulcasting for Firefox (RID)");var u=i.pc.getSenders()[1];e.log(u);var d=u.getParameters();e.log(d),u.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}i.pc.createOffer(function(r){if(e.debug(r),e.log("Setting local description"),c&&a&&("chrome"===e.webRTCAdapter.browserDetails.browser?(e.log("Enabling Simulcasting for Chrome (SDP munging)"),r.sdp=A(r.sdp)):"firefox"!==e.webRTCAdapter.browserDetails.browser&&e.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=r.sdp,i.pc.setLocalDescription(r),i.mediaConstraints=s,!i.iceDone&&!i.trickle)return void e.log("Waiting for all candidates...");e.log("Offer ready"),e.debug(t);var n={type:r.type,sdp:r.sdp};t.success(n)},t.error,s)}function b(r,n,t){t=t||{},t.success="function"==typeof t.success?t.success:e.noop,t.error="function"==typeof t.error?t.error:e.noop;var o=X[r];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return e.warn("Invalid handle"),void t.error("Invalid handle");var i=o.webrtcStuff,a=!0===t.simulcast;a?e.log("Creating answer (iceDone="+i.iceDone+", simulcast="+a+")"):e.log("Creating answer (iceDone="+i.iceDone+")");var s=null;s="firefox"==e.webRTCAdapter.browserDetails.browser||"edge"==e.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:I(n),offerToReceiveVideo:O(n)}:{mandatory:{OfferToReceiveAudio:I(n),OfferToReceiveVideo:O(n)}},e.debug(s);var c=x(n);if(c&&a&&"firefox"===e.webRTCAdapter.browserDetails.browser){e.log("Enabling Simulcasting for Firefox (RID)");var u=i.pc.getSenders()[1];e.log(u);var d=u.getParameters();e.log(d),u.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}i.pc.createAnswer(function(r){if(e.debug(r),e.log("Setting local description"),c&&a&&("chrome"===e.webRTCAdapter.browserDetails.browser?e.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==e.webRTCAdapter.browserDetails.browser&&e.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=r.sdp,i.pc.setLocalDescription(r),i.mediaConstraints=s,!i.iceDone&&!i.trickle)return void e.log("Waiting for all candidates...");var n={type:r.type,sdp:r.sdp};t.success(n)},t.error,s)}function h(r,n){n=n||{},n.success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop;var t=X[r];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return void e.warn("Invalid handle, not sending anything");var o=t.webrtcStuff;if(e.log("Sending offer/answer SDP..."),null===o.mySdp||void 0===o.mySdp)return void e.warn("Local SDP instance is invalid, not sending anything...");o.mySdp={type:o.pc.localDescription.type,sdp:o.pc.localDescription.sdp},!1===o.trickle&&(o.mySdp.trickle=!1),e.debug(n),o.sdpSent=!0,n.success(o.mySdp)}function w(r){var n=X[r];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return e.warn("Invalid handle"),0;var t=n.webrtcStuff;return t.pc.getStats&&"chrome"==e.webRTCAdapter.browserDetails.browser?null===t.remoteStream||void 0===t.remoteStream?(e.warn("Remote stream unavailable"),0):null===t.volume.timer||void 0===t.volume.timer?(e.log("Starting volume monitor"),t.volume.timer=setInterval(function(){t.pc.getStats(function(e){for(var r=e.result(),n=0;n<r.length;n++){var o=r[n];"ssrc"==o.type&&o.stat("audioOutputLevel")&&(t.volume.value=o.stat("audioOutputLevel"))}})},200),0):t.volume.value:(e.log("Getting the remote volume unsupported by browser"),0)}function y(r,n){var t=X[r];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return e.warn("Invalid handle"),!0;var o=t.webrtcStuff;return null===o.pc||void 0===o.pc?(e.warn("Invalid PeerConnection"),!0):void 0===o.myStream||null===o.myStream?(e.warn("Invalid local MediaStream"),!0):n?null===o.myStream.getVideoTracks()||void 0===o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length?(e.warn("No video track"),!0):!o.myStream.getVideoTracks()[0].enabled:null===o.myStream.getAudioTracks()||void 0===o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length?(e.warn("No audio track"),!0):!o.myStream.getAudioTracks()[0].enabled}function S(r,n,t){var o=X[r];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return e.warn("Invalid handle"),!1;var i=o.webrtcStuff;return null===i.pc||void 0===i.pc?(e.warn("Invalid PeerConnection"),!1):void 0===i.myStream||null===i.myStream?(e.warn("Invalid local MediaStream"),!1):n?null===i.myStream.getVideoTracks()||void 0===i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length?(e.warn("No video track"),!1):(i.myStream.getVideoTracks()[0].enabled=!t,!0):null===i.myStream.getAudioTracks()||void 0===i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length?(e.warn("No audio track"),!1):(i.myStream.getAudioTracks()[0].enabled=!t,!0)}function k(r){var n=X[r];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return e.warn("Invalid handle"),"Invalid handle";var t=n.webrtcStuff;return null===t.pc||void 0===t.pc?"Invalid PeerConnection":t.pc.getStats?null===t.bitrate.timer||void 0===t.bitrate.timer?(e.log("Starting bitrate timer (via getStats)"),t.bitrate.timer=setInterval(function(){t.pc.getStats().then(function(r){r.forEach(function(r){if(r){var n=!1;if(("video"===r.mediaType||r.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===r.type&&r.id.indexOf("rtcp")<0?n=!0:"ssrc"!=r.type||!r.bytesReceived||"VP8"!==r.googCodecName&&""!==r.googCodecName||(n=!0),n)if(t.bitrate.bsnow=r.bytesReceived,t.bitrate.tsnow=r.timestamp,null===t.bitrate.bsbefore||null===t.bitrate.tsbefore)t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow;else{var o=t.bitrate.tsnow-t.bitrate.tsbefore;"safari"==e.webRTCAdapter.browserDetails.browser&&(o/=1e3);var i=Math.round(8*(t.bitrate.bsnow-t.bitrate.bsbefore)/o);t.bitrate.value=i+" kbits/sec",t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):t.bitrate.value:(e.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function C(r){e.error("WebRTC error:",r)}function T(r,n){e.log("Cleaning WebRTC stuff");var t=X[r];if(null!==t&&void 0!==t){var o=t.webrtcStuff;if(null!==o&&void 0!==o){if(!0===n){var i={janus:"hangup",transaction:e.randomString(12)};null!==H&&void 0!==H&&(i.token=H),null!==Q&&void 0!==Q&&(i.apisecret=Q),e.debug("Sending hangup request (handle="+r+"):"),e.debug(i),j?(i.session_id=K,i.handle_id=r,M.send(JSON.stringify(i))):e.httpAPICall(U+"/"+K+"/"+r,{verb:"POST",withCredentials:B,data:i})}o.remoteStream=null,o.volume.timer&&clearInterval(o.volume.timer),o.volume.value=null,o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null;try{if(!o.streamExternal&&null!==o.myStream&&void 0!==o.myStream){e.log("Stopping local stream tracks");var a=o.myStream.getTracks();for(var s in a){var c=a[s];e.log(c),null!==c&&void 0!==c&&c.stop()}}}catch(e){}o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(e){}o.pc=null,o.mySdp=null,o.iceDone=!1,o.dataChannel=null,o.dtmfSender=null}t.oncleanup()}}function A(r){for(var n=r.split("\r\n"),t=!1,o=[-1],i=-1,a=null,s=null,c=null,u=null,d=-1,l=0;l<n.length;l++){var f=n[l].match(/m=(\w+) */);if(f){var v=f[1];if("video"===v){if(!(o[0]<0)){d=l;break}t=!0}else if(o[0]>-1){d=l;break}}else if(t){var m=n[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(m)o[0]=m[1],i=m[2],n.splice(l,1),l--;else{if(o[0]){var p=n[l].match("a=ssrc:"+o[0]+" cname:(.+)");if(p&&(a=p[1]),p=n[l].match("a=ssrc:"+o[0]+" msid:(.+)"),p&&(s=p[1]),p=n[l].match("a=ssrc:"+o[0]+" mslabel:(.+)"),p&&(c=p[1]),p=n[l].match("a=ssrc:"+o+" label:(.+)"),p&&(u=p[1]),0===n[l].indexOf("a=ssrc:"+i)){n.splice(l,1),l--;continue}if(0===n[l].indexOf("a=ssrc:"+o[0])){n.splice(l,1),l--;continue}}0!=n[l].length||(n.splice(l,1),l--)}}}if(o[0]<0){d=-1,t=!1;for(var l=0;l<n.length;l++){var f=n[l].match(/m=(\w+) */);if(f){var v=f[1];if("video"===v){if(!(o[0]<0)){d=l;break}t=!0}else if(o[0]>-1){d=l;break}}else if(t){if(o[0]<0){var g=n[l].match(/a=ssrc:(\d+)/);if(g){o[0]=g[1],n.splice(l,1),l--;continue}}else{var p=n[l].match("a=ssrc:"+o[0]+" cname:(.+)");if(p&&(a=p[1]),p=n[l].match("a=ssrc:"+o[0]+" msid:(.+)"),p&&(s=p[1]),p=n[l].match("a=ssrc:"+o[0]+" mslabel:(.+)"),p&&(c=p[1]),p=n[l].match("a=ssrc:"+o+" label:(.+)"),p&&(u=p[1]),0===n[l].indexOf("a=ssrc:"+i)){n.splice(l,1),l--;continue}if(0===n[l].indexOf("a=ssrc:"+o[0])){n.splice(l,1),l--;continue}}0!=n[l].length||(n.splice(l,1),l--)}}}if(o[0]<0)return e.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),r;d<0&&(d=n.length),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(var l=0;l<o.length;l++)a&&(n.splice(d,0,"a=ssrc:"+o[l]+" cname:"+a),d++),s&&(n.splice(d,0,"a=ssrc:"+o[l]+" msid:"+s),d++),c&&(n.splice(d,0,"a=ssrc:"+o[l]+" mslabel:"+s),d++),u&&(n.splice(d,0,"a=ssrc:"+o[l]+" label:"+s),d++);return n.splice(d,0,"a=ssrc-group:SIM "+o[0]+" "+o[1]+" "+o[2]),r=n.join("\r\n"),r.endsWith("\r\n")||(r+="\r\n"),r}function R(r){return e.debug("isAudioSendEnabled:",r),void 0===r||null===r||!1!==r.audio&&(void 0===r.audioSend||null===r.audioSend||!0===r.audioSend)}function D(r){return e.debug("isAudioSendRequired:",r),void 0!==r&&null!==r&&(!1!==r.audio&&!1!==r.audioSend&&(void 0!==r.failIfNoAudio&&null!==r.failIfNoAudio&&!0===r.failIfNoAudio))}function I(r){return e.debug("isAudioRecvEnabled:",r),void 0===r||null===r||!1!==r.audio&&(void 0===r.audioRecv||null===r.audioRecv||!0===r.audioRecv)}function x(r){return e.debug("isVideoSendEnabled:",r),void 0===r||null===r||!1!==r.video&&(void 0===r.videoSend||null===r.videoSend||!0===r.videoSend)}function E(r){return e.debug("isVideoSendRequired:",r),void 0!==r&&null!==r&&(!1!==r.video&&!1!==r.videoSend&&(void 0!==r.failIfNoVideo&&null!==r.failIfNoVideo&&!0===r.failIfNoVideo))}function O(r){return e.debug("isVideoRecvEnabled:",r),void 0===r||null===r||!1!==r.video&&(void 0===r.videoRecv||null===r.videoRecv||!0===r.videoRecv)}function V(r){return e.debug("isDataEnabled:",r),"edge"==e.webRTCAdapter.browserDetails.browser?(e.warn("Edge doesn't support data channels yet"),!1):void 0!==r&&null!==r&&!0===r.data}function P(r){return e.debug("isTrickleEnabled:",r),void 0===r||null===r||!0===r}if(void 0===e.initDone)return r.error("Library not initialized"),{};if(!e.isWebrtcSupported())return r.error("WebRTC not supported by this browser"),{};if(e.log("Library initialized: "+e.initDone),r=r||{},r.success="function"==typeof r.success?r.success:e.noop,r.error="function"==typeof r.error?r.error:e.noop,r.destroyed="function"==typeof r.destroyed?r.destroyed:e.noop,null===r.server||void 0===r.server)return r.error("Invalid gateway url"),{};var j=!1,M=null,F={},_=null,L=null,N=0,U=r.server;e.isArray(U)?(e.log("Multiple servers provided ("+U.length+"), will use the first that works"),U=null,L=r.server,e.debug(L)):0===U.indexOf("ws")?(j=!0,e.log("Using WebSockets to contact Janus: "+U)):(j=!1,e.log("Using REST API to contact Janus: "+U));var J=r.iceServers;void 0!==J&&null!==J||(J=[{urls:"stun:stun.l.google.com:19302"}]);var q=r.iceTransportPolicy,W=r.bundlePolicy,G=r.ipv6;void 0!==G&&null!==G||(G=!1);var B=!1;void 0!==r.withCredentials&&null!==r.withCredentials&&(B=!0===r.withCredentials);var z=null;void 0!==r.max_poll_events&&null!==r.max_poll_events&&(z=r.max_poll_events),z<1&&(z=1);var H=null;void 0!==r.token&&null!==r.token&&(H=r.token);var Q=null;void 0!==r.apisecret&&null!==r.apisecret&&(Q=r.apisecret),this.destroyOnUnload=!0,void 0!==r.destroyOnUnload&&null!==r.destroyOnUnload&&(this.destroyOnUnload=!0===r.destroyOnUnload);var Y=!1,K=null,X={},Z=this,$=0,ee={};i(r),this.getServer=function(){return U},this.isConnected=function(){return Y},this.getSessionId=function(){return K},this.destroy=function(e){a(e)},this.attach=function(e){s(e)},this.timeoutSessionCallback="function"==typeof r.timeoutSessionCallback?r.timeoutSessionCallback:e.noop}return e.sessions={},e.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",e.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var r=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),r>=26&&r<=n||e.checkJanusExtension()}return!0},e.useDefaultDependencies=function(r){var n=r&&r.fetch||fetch,t=r&&r.Promise||Promise,o=r&&r.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new o(e,r)},isArray:function(e){return Array.isArray(e)},checkJanusExtension:function(){return null!==document.querySelector("#janus-extension-installed")},webRTCAdapter:r&&r.adapter||adapter,httpAPICall:function(r,o){var i={method:o.verb,cache:"no-cache"};void 0!==o.withCredentials&&(i.credentials=!0===o.withCredentials?"include":o.withCredentials?o.withCredentials:"omit"),void 0!==o.body&&(i.body=JSON.stringify(o.body));var a=n(r,i).catch(function(e){return t.reject({message:"Probably a network error, is the gateway down?",error:e})});if(void 0!==o.timeout){var s=new t(function(e,r){var n=setTimeout(function(){return clearTimeout(n),r({message:"Request timed out",timeout:o.timeout})},o.timeout)});a=t.race([a,s])}return a.then(function(r){return r.ok?typeof o.success==typeof e.noop?r.json().then(function(e){o.success(e)}).catch(function(e){return t.reject({message:"Failed to parse response body",error:e,response:r})}):void 0:t.reject({message:"API call failed",response:r})}).catch(function(r){typeof o.error==typeof e.noop&&o.error(r.message||"<< internal error >>",r)}),a}}},e.useOldDependencies=function(r){var n=r&&r.jQuery||jQuery,t=r&&r.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new t(e,r)},isArray:function(e){return n.isArray(e)},checkJanusExtension:function(){return n("#janus-extension-installed").length>0},webRTCAdapter:r&&r.adapter||adapter,httpAPICall:function(r,t){var o=void 0!==t.body?{contentType:"application/json",data:JSON.stringify(t.body)}:{},i=void 0!==t.withCredentials?{xhrFields:{withCredentials:t.withCredentials}}:{};return n.ajax(n.extend(o,i,{url:r,type:t.verb,cache:!1,dataType:"json",async:t.async,timeout:t.timeout,success:function(r){typeof t.success==typeof e.noop&&t.success(r)},error:function(r,n,o){typeof t.error==typeof e.noop&&t.error(n,o)}}))}}},e.noop=function(){},e.init=function(r){if(r=r||{},r.callback="function"==typeof r.callback?r.callback:e.noop,!0===e.initDone)r.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),e.trace=e.noop,e.debug=e.noop,e.vdebug=e.noop,e.log=e.noop,e.warn=e.noop,e.error=e.noop,!0===r.debug||"all"===r.debug)e.trace=console.trace.bind(console),e.debug=console.debug.bind(console),e.vdebug=console.debug.bind(console),e.log=console.log.bind(console),e.warn=console.warn.bind(console),e.error=console.error.bind(console);else if(Array.isArray(r.debug))for(var n in r.debug){var t=r.debug[n];switch(t){case"trace":e.trace=console.trace.bind(console);break;case"debug":e.debug=console.debug.bind(console);break;case"vdebug":e.vdebug=console.debug.bind(console);break;case"log":e.log=console.log.bind(console);break;case"warn":e.warn=console.warn.bind(console);break;case"error":e.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}e.log("Initializing library");var o=r.dependencies||e.useDefaultDependencies();e.isArray=o.isArray,e.webRTCAdapter=o.webRTCAdapter,e.httpAPICall=o.httpAPICall,e.checkJanusExtension=o.checkJanusExtension,e.newWebSocket=o.newWebSocket,e.listDevices=function(r,n){r="function"==typeof r?r:e.noop,null==n&&(n={audio:!0,video:!0}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia(n).then(function(n){navigator.mediaDevices.enumerateDevices().then(function(t){e.debug(t),r(t);try{var o=n.getTracks();for(var i in o){var a=o[i];null!==a&&void 0!==a&&a.stop()}}catch(e){}})}).catch(function(n){e.error(n),r([])}):(e.warn("navigator.mediaDevices unavailable"),r([]))},e.attachMediaStream=function(r,n){if("chrome"===e.webRTCAdapter.browserDetails.browser){e.webRTCAdapter.browserDetails.version>=43?r.srcObject=n:void 0!==r.src?r.src=URL.createObjectURL(n):e.error("Error attaching stream to element")}else r.srcObject=n},e.reattachMediaStream=function(r,n){if("chrome"===e.webRTCAdapter.browserDetails.browser){e.webRTCAdapter.browserDetails.version>=43?r.srcObject=n.srcObject:void 0!==r.src?r.src=n.src:e.error("Error reattaching stream to element")}else r.srcObject=n.srcObject};var i=window.onbeforeunload;window.onbeforeunload=function(){e.log("Closing window");for(var r in e.sessions)null!==e.sessions[r]&&void 0!==e.sessions[r]&&e.sessions[r].destroyOnUnload&&(e.log("Destroying session "+r),e.sessions[r].destroy({asyncRequest:!1}));i&&"function"==typeof i&&i()},e.initDone=!0,r.callback()}},e.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},e.randomString=function(e){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<e;t++){var o=Math.floor(Math.random()*r.length);n+=r.substring(o,o+1)}return n},e})},{}],10:[function(e,r,n){"use strict";function t(e){if(!adapter)throw"Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter";if(this.configs=e,!this.configs.server)throw"'server' parameter is mandatory.";this.configs.server.includes("http")&&(this.configs.server=this.configs.server+"/janus"),this.configs.debug||(this.configs.debug="all"),this.engine=null,this.videoRoomPlugin=null,this.isOnlyAudio=!1,this.currentDialogId=null,this.remoteFeeds=[],this.remoteJseps=[],this.remoteFeedsAttachingInProgress=[],this.currentMidiaDeviceId=null,this.bitrateTimers=[],this.emitter=new a}var o=e("./janus.umd"),i=e("./qbUtils"),a=e("fbemitter").EventEmitter;t.attachMediaStream=function(e,r){o.attachMediaStream(e,r)},t.listDevices=function(e){navigator.mediaDevices.enumerateDevices().then(function(r){console.debug(r),e(r)}).catch(function(r){console.error(r),e([])})},t.listVideoinputDevices=function(e){t.listDevices(function(r){for(var n=[],t=0;t!==r.length;++t){var o=r[t];if("videoinput"===o.kind){var i=o.label||"camera "+(n.length+1),a=o.deviceId;n.push({label:i,deviceId:a})}}e(n)})},t.prototype={createSession:function(e){var r=this;o.init({debug:this.configs.debug,callback:function(){if(!o.isWebrtcSupported())return void("function"==typeof e.error&&e.error("Your browser does not support WebRTC, so you can't use this functionality."));r.engine=new o({server:r.configs.server,iceServers:r.configs.iceServers,success:function(){"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(r){"function"==typeof e.error&&i.safeCallbackCall(e.error,r)},destroyed:function(){"function"==typeof e.destroyed&&i.safeCallbackCall(e.destroyed)},timeoutSessionCallback:function(){"function"==typeof e.timeoutSessionCallback&&i.safeCallbackCall(e.timeoutSessionCallback)}})}})},getSessionId:function(){return this.engine?this.engine.getSessionId():null},destroySession:function(e){this.engine.destroy({}),"function"==typeof e.success&&i.safeCallbackCall(e.success)},attachVideoConferencingPlugin:function(e,r,n){var t=this,o=null;this.engine.attach({plugin:"janus.plugin.videoroom",success:function(a){if(e){o=a,o.userId=r,t.remoteFeedsAttachingInProgress[r]=o;var s={request:"join",room:t.currentDialogId,ptype:"listener",feed:r};"safari"===adapter.browserDetails.browser&&(s.offer_video=!1),o.send({message:s})}else t.videoRoomPlugin=a;"function"==typeof n.success&&i.safeCallbackCall(n.success)},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(e))},consentDialog:function(e){"function"==typeof n.consentDialog&&i.safeCallbackCall(n.consentDialog,e)},mediaState:function(e,r){"function"==typeof n.mediaState&&i.safeCallbackCall(n.mediaState,e,r)},webrtcState:function(e){"function"==typeof n.webrtcState&&i.safeCallbackCall(n.webrtcState,e)},slowLink:function(e,r){"function"==typeof n.slowLink&&i.safeCallbackCall(n.slowLink,e,r)},iceState:function(e){"function"==typeof n.iceState&&i.safeCallbackCall(n.iceState,e)},onmessage:function(r,o){var a=r.videoroom;if(e){if(a)if("attached"===a){var s=r.id;t.remoteFeeds[s]=t.remoteFeedsAttachingInProgress[s],t.remoteFeedsAttachingInProgress[s]=null}else r.error&&"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(r.error));if(o){var s=r.id;t.remoteJseps[s]=o,t.createAnswer(t.remoteFeeds[s],o,{success:function(){},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(e))}})}}else{if(a)if("joined"===a)t.createOffer({useAudio:!0,useVideo:!t.isOnlyAudio},{success:function(){if(r.publishers){var e=r.publishers;for(var n in e){var o=e[n].id,i=e[n].display;t.emitter.emit("participantjoined",o,i)}}},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(e))}});else if("event"===a)if(r.publishers){var c=r.publishers;for(var u in c){var d=c[u].id,l=c[u].display;t.emitter.emit("participantjoined",d,l)}}else if(r.leaving){var s=r.leaving,f=t.detachRemoteFeed(s);f&&t.emitter.emit("participantleft",s,null)}else if(r.unpublished){var s=r.unpublished;if("ok"!=s){var f=t.detachRemoteFeed(s);f&&t.emitter.emit("participantleft",s,null)}}else r.error&&"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(r.error));o&&t.videoRoomPlugin.handleRemoteJsep({jsep:o})}},onlocalstream:function(e){t.emitter.emit("localstream",e)},onremotestream:function(e){o.stream=e,t.emitter.emit("remotestream",e,o.userId)},oncleanup:function(){console.info("ON CLEANUP"),"function"==typeof n.oncleanup&&i.safeCallbackCall(n.oncleanup)},detached:function(){}})},getPluginId:function(){return this.videoRoomPlugin?this.videoRoomPlugin.getId():null},detachVideoConferencingPlugin:function(e){var r=this,n=function(){r.videoRoomPlugin=null,Object.keys(r.remoteFeeds).forEach(function(e){r.detachRemoteFeed(e)}),r.remoteFeeds=[],r.remoteJseps=[],r.currentMidiaDeviceId=null};this.videoRoomPlugin.detach({success:function(){n(),"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(r){n(),"function"==typeof e.error&&i.safeCallbackCall(e.error,r)}})},join:function(e,r,n,t){var o=this;if("boolean"!=typeof n)throw"'isOnlyAudio' parameter can be of type 'boolean' only.";o.isOnlyAudio=n,"safari"===adapter.browserDetails.browser&&(o.isOnlyAudio=!0),console.info("isOnlyAudio: "+o.isOnlyAudio);var a={request:"join",room:e,ptype:"publisher",id:r};this.videoRoomPlugin.send({message:a,success:function(n){o.currentDialogId=e,o.currentUserId=r,"function"==typeof t.success&&i.safeCallbackCall(t.success)},error:function(e){"function"==typeof t.error&&i.safeCallbackCall(t.error,e)}})},leave:function(e){var r=this;if(console.warn("leave"),!r.engine.isConnected())return void("function"==typeof e.success&&i.safeCallbackCall(e.success));var n={request:"leave",room:this.currentDialogId,id:this.currentUserId};this.videoRoomPlugin&&this.videoRoomPlugin.send({message:n}),this.currentDialogId=null,this.currentUserId=null,console.warn("resp"),"function"==typeof e.success&&i.safeCallbackCall(e.success)},listOnlineParticipants:function(e,r){var n={request:"listparticipants",room:e};this.videoRoomPlugin.send({message:n,success:function(e){var n=[];e&&(n=e.participants),"function"==typeof r.success&&i.safeCallbackCall(r.success,n)},error:function(e){"function"==typeof r.error&&i.safeCallbackCall(r.error,e)}})},toggleAudioMute:function(){return this.videoRoomPlugin.isAudioMuted()?this.videoRoomPlugin.unmuteAudio():this.videoRoomPlugin.muteAudio(),this.videoRoomPlugin.isAudioMuted()},isAudioMuted:function(){return this.videoRoomPlugin.isAudioMuted()},toggleRemoteAudioMute:function(e){var r=this.remoteFeeds[e];if(!r)return!1;var n=r.stream.getAudioTracks();if(n&&n.length>0){for(var t=0;t<n.length;++t)n[t].enabled=!n[t].enabled;return!n[0].enabled}return!1},isRemoteAudioMuted:function(e){var r=this.remoteFeeds[e];if(!r)return!1;var n=r.stream.getAudioTracks();return!!(n&&n.length>0)&&!n[0].enabled},toggleVideoMute:function(){return this.videoRoomPlugin.isVideoMuted()?this.videoRoomPlugin.unmuteVideo():this.videoRoomPlugin.muteVideo(),this.videoRoomPlugin.isVideoMuted()},isVideoMuted:function(){return this.videoRoomPlugin.isVideoMuted()},toggleRemoteVideoMute:function(e){var r=this.remoteFeeds[e];if(!r)return!1;var n=r.stream.getVideoTracks();if(n&&n.length>0){for(var t=0;t<n.length;++t)n[t].enabled=!n[t].enabled;return!n[0].enabled}return!1},isRemoteVideoMuted:function(e){var r=this.remoteFeeds[e];if(!r)return!1;var n=r.stream.getVideoTracks();return!!(n&&n.length>0)&&!n[0].enabled},switchVideoinput:function(e,r){if(!this.videoRoomPlugin)return void("function"==typeof r.error&&i.safeCallbackCall(r.error,"No active stream"));if(this.isOnlyAudio)throw"Can't switch video input in audio only call.";this.currentMidiaDeviceId=null;var n=this;this.createOffer({video:{deviceId:e},replaceVideo:!0},{success:function(){console.info("switchVideoinput: success"),n.currentMidiaDeviceId=e,"function"==typeof r.success&&i.safeCallbackCall(r.success)},error:function(e){console.info("switchVideoinput: error",e),"function"==typeof r.error&&i.safeCallbackCall(r.error,e)}})},iceRestart:function(e,r){if(r){console.info("Performing remote ICE restart for user: ",e);var n=this.remoteFeeds[e];if(!n)return void("function"==typeof r.error&&i.safeCallbackCall(r.error,"No such user feed"));var t={request:"configure",restart:!0};n.send({message:t}),"function"==typeof r.success&&i.safeCallbackCall(r.success)}else console.info("Performing local ICE restart"),this.createOffer({iceRestart:!0},{success:function(){"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(r){"function"==typeof e.error&&i.safeCallbackCall(e.error,r)}})},createOffer:function(e,r){console.warn("createOffer, inputParams: ",e);var n,t=this,o=e.useAudio,i=e.useVideo,a=e.stream,s=e.replaceVideo,c=e.iceRestart,u=t.configs.video?t.configs.video.quality:null,d=t.configs.video?t.configs.video.frameRate:null;a?n={stream:a}:s?(n={media:e},u&&(n.media.video=u),d&&(n.media.videoFrameRate={min:d,max:d})):c?n=e:(n={media:{audioRecv:!1,videoRecv:!1,audioSend:o,videoSend:i}},u&&(n.media.video=u),d&&(n.media.videoFrameRate={min:d,ideal:d})),console.info("createOffer params: ",n),n.success=function(e){var n={request:"configure"};s||c||(n.audio=o,n.video=i),console.info("createOffer publish: ",n),t.videoRoomPlugin.send({message:n,jsep:e}),"function"==typeof r.success&&r.success()},n.error=function(e){o?t.createOffer({useAudio:!1,useVideo:!1},r):"function"==typeof r.error&&r.error(e)},this.videoRoomPlugin.createOffer(n)},createAnswer:function(e,r,n){var t=this;e.createAnswer({jsep:r,media:{audioSend:!1,videoSend:!1},
success:function(r){var o={request:"start",room:t.currentDialogId};e.send({message:o,jsep:r}),"function"==typeof n.success&&i.safeCallbackCall(n.success)},error:function(e){console.error("createAnswer error: ",e),"function"==typeof n.error&&i.safeCallbackCall(n.error,e)}})},detachRemoteFeed:function(e){var r=this.remoteFeeds[e];return!!r&&(r.detach(),this.remoteFeeds[e]=null,this.remoteJseps[e]=null,!0)},showBitrate:function(e,r){var n=this.remoteFeeds[e];"chrome"!==adapter.browserDetails.browser&&"firefox"!==adapter.browserDetails.browser||(this.bitrateTimers[e]=setInterval(function(){var e=n.getBitrate();r.text(e)},1e3))},hideBitrate:function(e,r){this.bitrateTimers[e]&&clearInterval(this.bitrateTimers[e]),this.bitrateTimers[e]=null,r.text=null},on:function(e,r){this.emitter.addListener(e,r)},removeAllListeners:function(e){e?this.emitter.removeAllListeners(e):this.emitter.removeAllListeners()}},r.exports=t},{"./janus.umd":9,"./qbUtils":11,fbemitter:1}],11:[function(e,r,n){"use strict";var t={safeCallbackCall:function(){for(var e,r=arguments[0].toString(),n=r.split("(")[0].split(" ")[1],t=[],o=0;o<arguments.length;o++)t.push(arguments[o]);e=t.shift();try{e.apply(null,t)}catch(e){""===n?console.error("Error: "+e):console.error("Error in listener "+n+": "+e)}},wrapError:function(e){return"string"==typeof e?{error_code:400,error:e}:e},getUUID:function(){var e=window.navigator,r=window.screen,n=e.mimeTypes.length;return n+=e.userAgent.replace(/\D+/g,""),n+=e.plugins.length,n+=r.height||"",n+=r.width||"",n+=r.pixelDepth||""}};r.exports=t},{}]},{},[10])(10)});