!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.QBVideoConferencingClient=e()}}(function(){return function e(n,r,t){function o(a,s){if(!r[a]){if(!n[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};n[a][0].call(l.exports,function(e){var r=n[a][1][e];return o(r||e)},l,l.exports,e,n,r,t)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,n,r){var t={EventEmitter:e("./lib/BaseEventEmitter"),EmitterSubscription:e("./lib/EmitterSubscription")};n.exports=t},{"./lib/BaseEventEmitter":2,"./lib/EmitterSubscription":3}],2:[function(e,n,r){(function(r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=e("./EmitterSubscription"),i=e("./EventSubscriptionVendor"),a=e("fbjs/lib/emptyFunction"),s=e("fbjs/lib/invariant"),u=function(){function e(){t(this,e),this._subscriber=new i,this._currentSubscription=null}return e.prototype.addListener=function(e,n,r){return this._subscriber.addSubscription(e,new o(this._subscriber,n,r))},e.prototype.once=function(e,n,r){var t=this;return this.addListener(e,function(){t.removeCurrentListener(),n.apply(r,arguments)})},e.prototype.removeAllListeners=function(e){this._subscriber.removeAllSubscriptions(e)},e.prototype.removeCurrentListener=function(){this._currentSubscription||("production"!==r.env.NODE_ENV?s(!1,"Not in an emitting cycle; there is no current subscription"):s(!1)),this._subscriber.removeSubscription(this._currentSubscription)},e.prototype.listeners=function(e){var n=this._subscriber.getSubscriptionsForType(e);return n?n.filter(a.thatReturnsTrue).map(function(e){return e.listener}):[]},e.prototype.emit=function(e){var n=this._subscriber.getSubscriptionsForType(e);if(n){for(var r=Object.keys(n),t=0;t<r.length;t++){var o=r[t],i=n[o];i&&(this._currentSubscription=i,this.__emitToSubscription.apply(this,[i].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},e.prototype.__emitToSubscription=function(e,n){var r=Array.prototype.slice.call(arguments,2);e.listener.apply(e.context,r)},e}();n.exports=u}).call(this,e("_process"))},{"./EmitterSubscription":3,"./EventSubscriptionVendor":5,_process:8,"fbjs/lib/emptyFunction":6,"fbjs/lib/invariant":7}],3:[function(e,n,r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var i=e("./EventSubscription"),a=function(e){function n(r,o,i){t(this,n),e.call(this,r),this.listener=o,this.context=i}return o(n,e),n}(i);n.exports=a},{"./EventSubscription":4}],4:[function(e,n,r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(n){t(this,e),this.subscriber=n}return e.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},e}();n.exports=o},{}],5:[function(e,n,r){(function(r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=e("fbjs/lib/invariant"),i=function(){function e(){t(this,e),this._subscriptionsForType={},this._currentSubscription=null}return e.prototype.addSubscription=function(e,n){n.subscriber!==this&&("production"!==r.env.NODE_ENV?o(!1,"The subscriber of the subscription is incorrectly set."):o(!1)),this._subscriptionsForType[e]||(this._subscriptionsForType[e]=[]);var t=this._subscriptionsForType[e].length;return this._subscriptionsForType[e].push(n),n.eventType=e,n.key=t,n},e.prototype.removeAllSubscriptions=function(e){void 0===e?this._subscriptionsForType={}:delete this._subscriptionsForType[e]},e.prototype.removeSubscription=function(e){var n=e.eventType,r=e.key,t=this._subscriptionsForType[n];t&&delete t[r]},e.prototype.getSubscriptionsForType=function(e){return this._subscriptionsForType[e]},e}();n.exports=i}).call(this,e("_process"))},{_process:8,"fbjs/lib/invariant":7}],6:[function(e,n,r){"use strict";function t(e){return function(){return e}}var o=function(){};o.thatReturns=t,o.thatReturnsFalse=t(!1),o.thatReturnsTrue=t(!0),o.thatReturnsNull=t(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},n.exports=o},{}],7:[function(e,n,r){(function(e){"use strict";function r(e,n,r,o,i,a,s,u){if(t(n),!e){var c;if(void 0===n)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,o,i,a,s,u],d=0;c=new Error(n.replace(/%s/g,function(){return l[d++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}}var t=function(e){};"production"!==e.env.NODE_ENV&&(t=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),n.exports=r}).call(this,e("_process"))},{_process:8}],8:[function(e,n,r){function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(d===setTimeout)return setTimeout(e,0);if((d===t||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(n){try{return d.call(null,e,0)}catch(n){return d.call(this,e,0)}}}function a(e){if(f===clearTimeout)return clearTimeout(e);if((f===o||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(n){try{return f.call(null,e)}catch(n){return f.call(this,e)}}}function s(){m&&p&&(m=!1,p.length?g=p.concat(g):b=-1,g.length&&u())}function u(){if(!m){var e=i(s);m=!0;for(var n=g.length;n;){for(p=g,g=[];++b<n;)p&&p[b].run();b=-1,n=g.length}p=null,m=!1,a(e)}}function c(e,n){this.fun=e,this.array=n}function l(){}var d,f,v=n.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:t}catch(e){d=t}try{f="function"==typeof clearTimeout?clearTimeout:o}catch(e){f=o}}();var p,g=[],m=!1,b=-1;v.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];g.push(new c(e,n)),1!==g.length||m||i(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={},v.on=l,v.addListener=l,v.once=l,v.off=l,v.removeListener=l,v.removeAllListeners=l,v.emit=l,v.prependListener=l,v.prependOnceListener=l,v.listeners=function(e){return[]},v.binding=function(e){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(e){throw new Error("process.chdir is not supported")},v.umask=function(){return 0}},{}],9:[function(e,n,r){function t(e){function n(e){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",t=0;t<e;t++){var o=Math.floor(Math.random()*n.length);r+=n.substring(o,o+1)}return r}function r(){if(null!=Y){if(t.debug("Long poll..."),!z)return void t.warn("Is the gateway down? (connected=false)");var n=J+"/"+Y+"?rid="+(new Date).getTime();void 0!==G&&null!==G&&(n=n+"&maxev="+G),null!==B&&void 0!==B&&(n=n+"&token="+B),null!==H&&void 0!==H&&(n=n+"&apisecret="+H),t.ajax({type:"GET",url:n,cache:!1,timeout:6e4,success:o,error:function(n,o,i){if(t.error(o+": "+i),++X>3)return z=!1,void e.error("Lost connection to the gateway (is it down?)");r()},dataType:"json"})}}function o(e){if(t.debug("JRCV: ",JSON.stringify(e)),X=0,_||void 0===Y||null===Y||setTimeout(r,200),_||!Array.isArray(e)){if("keepalive"===e.janus)return void t.vdebug("Got a keepalive on session "+Y);if("ack"!==e.janus)if("success"!==e.janus){if("webrtcup"===e.janus){t.debug("Got a webrtcup event on session "+Y);var n=e.sender;if(void 0===n||null===n)return void t.warn("Missing sender...");var i=K[n];return void 0===i||null===i?void t.warn("This handle is not attached to this session"):void i.webrtcState(!0)}if("hangup"===e.janus);else if("detached"===e.janus){t.debug("Got a detached event on session "+Y);var n=e.sender;if(void 0===n||null===n)return void t.warn("Missing sender...");var i=K[n];if(void 0===i||null===i)return;i.ondetached(),i.detach()}else if("media"===e.janus){t.debug("Got a media event on session "+Y);var n=e.sender;if(void 0===n||null===n)return void t.warn("Missing sender...");var i=K[n];if(void 0===i||null===i)return void t.warn("This handle is not attached to this session");i.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){t.debug("Got a slowlink event on session "+Y);var n=e.sender;if(void 0===n||null===n)return void t.warn("Missing sender...");var i=K[n];if(void 0===i||null===i)return void t.warn("This handle is not attached to this session");i.slowLink(e.uplink,e.nacks)}else{if("error"===e.janus){t.error("Ooops: "+e.error.code+" "+e.error.reason);var a=e.transaction;if(null!==a&&void 0!==a){var s=Z[a];null!==s&&void 0!==s&&s(e),delete Z[a]}return}if("event"===e.janus){t.debug("Got a plugin event on session "+Y);var n=e.sender;if(void 0===n||null===n)return void t.warn("Missing sender...");var u=e.plugindata;if(void 0===u||null===u)return void t.warn("Missing plugindata...");t.debug("  -- Event is coming from "+n+" ("+u.plugin+")");var c=u.data,i=K[n];if(void 0===i||null===i)return void t.warn("This handle is not attached to this session");var l=e.jsep;void 0!==l&&null!==l&&t.debug("Handling SDP as well...");var d=i.onmessage;null!==d&&void 0!==d?(t.debug("Notifying application..."),d(c,l)):t.debug("No provided notification callback")}else t.warn("Unkown message/event  '"+e.janus+"' on session "+Y)}}else{t.debug("Got a success on session "+Y);var a=e.transaction;if(null!==a&&void 0!==a){var s=Z[a];null!==s&&void 0!==s?s(e):t.debug("no transaction success callback for id: ",a),delete Z[a]}}else{t.debug("Got an ack on session "+Y);var a=e.transaction;if(null!==a&&void 0!==a){var s=Z[a];null!==s&&void 0!==s&&s(e),delete Z[a]}}}else for(var f=0;f<e.length;f++)o(e[f])}function i(){if(null!==J&&_&&z){F=setTimeout(i,3e4);var e={janus:"keepalive",session_id:Y,transaction:n(12)};null!==B&&void 0!==B&&(e.token=B),null!==H&&void 0!==H&&(e.apisecret=H);var r=JSON.stringify(e);P.send(r),t.debug("JSNT: ",r)}}function a(s){var u=n(12),c={janus:"create",transaction:u};if(null!==B&&void 0!==B&&(c.token=B),null!==H&&void 0!==H&&(c.apisecret=H),null===J&&Array.isArray(L)&&(J=L[V],0===J.indexOf("ws")?(_=!0,t.log("Server #"+(V+1)+": trying WebSockets to contact Janus ("+J+")")):(_=!1,t.log("Server #"+(V+1)+": trying REST API to contact Janus ("+J+")"))),_){P=new WebSocket(J,"janus-protocol"),N={error:function(){if(t.error("Error connecting to the Janus WebSockets server... "+J),Array.isArray(L))return++V==L.length?void s.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(J=null,void setTimeout(function(){a(s)},200));s.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){Z[u]=function(e){if("success"!==e.janus)return t.error("Ooops: "+e.error.code+" "+e.error.reason),void s.error(e.error.reason);F=setTimeout(i,3e4),z=!0,Y=e.data.id,t.log("Created session: "+Y),t.sessions[Y]=Q,s.success()},P.send(JSON.stringify(c))},message:function(e){o(JSON.parse(e.data))},close:function(){null!==J&&z&&(z=!1,e.error("Lost connection to the gateway (is it down?)"))}};for(var l in N)P.addEventListener(l,N[l])}else t.ajax({type:"POST",url:J,cache:!1,contentType:"application/json",data:JSON.stringify(c),success:function(e){if(t.debug(e),"success"!==e.janus)return t.error("Ooops: "+e.error.code+" "+e.error.reason),void s.error(e.error.reason);z=!0,Y=e.data.id,t.log("Created session: "+Y),t.sessions[Y]=Q,r(),s.success()},error:function(e,n,r){if(t.error(n+": "+r),Array.isArray(L))return++V==L.length?void s.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(J=null,void setTimeout(function(){a(s)},200));""===r?s.error(n+": Is the gateway down?"):s.error(n+": "+r)},dataType:"json"})}function s(r){r=r||{},r.success="function"==typeof r.success?r.success:t.noop;var o=!0;if(void 0!==r.asyncRequest&&null!==r.asyncRequest&&(o=!0===r.asyncRequest),t.log("Destroying session "+Y+" (async="+o+")"),!z)return t.warn("Is the gateway down? (connected=false)"),void r.success();if(void 0===Y||null===Y)return t.warn("No session to destroy"),r.success(),void e.destroyed();delete t.sessions[Y];for(var i in K){var a=K[i];t.log("Destroying handle "+a.id+" ("+a.plugin+")"),v(a.id,{asyncRequest:o})}var s={janus:"destroy",transaction:n(12)};if(null!==B&&void 0!==B&&(s.token=B),null!==H&&void 0!==H&&(s.apisecret=H),_){s.session_id=Y;var u=function(){for(var e in N)P.removeEventListener(e,N[e]);P.removeEventListener("message",c),P.removeEventListener("error",l),F&&clearTimeout(F)},c=function(n){var t=JSON.parse(n.data);t.session_id==s.session_id&&t.transaction==s.transaction&&(u(),r.success(),e.destroyed())},l=function(n){u(),r.error("Failed to destroy the gateway: Is the gateway down?"),e.destroyed()};P.addEventListener("message",c),P.addEventListener("error",l);var d=JSON.stringify(s);return P.send(d),void t.debug("JSNT: ",d)}t.ajax({type:"POST",url:J+"/"+Y,async:o,cache:!1,contentType:"application/json",data:JSON.stringify(s),success:function(n){t.log("Destroyed session:"),t.debug(n),Y=null,z=!1,"success"!==n.janus&&t.error("Ooops: "+n.error.code+" "+n.error.reason),r.success(),e.destroyed()},error:function(n,o,i){t.error(o+": "+i),Y=null,z=!1,r.success(),e.destroyed()},dataType:"json"})}function u(e){if(e=e||{},e.success="function"==typeof e.success?e.success:t.noop,e.error="function"==typeof e.error?e.error:t.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:t.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:t.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:t.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:t.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:t.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:t.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:t.noop,e.ondata="function"==typeof e.ondata?e.ondata:t.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:t.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:t.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:t.noop,!z)return t.warn("Is the gateway down? (connected=false)"),void e.error("Is the gateway down? (connected=false)");var r=e.plugin;if(void 0===r||null===r)return t.error("Invalid plugin"),void e.error("Invalid plugin");var o=n(12),i={janus:"attach",plugin:r,transaction:o};if(null!==B&&void 0!==B&&(i.token=B),null!==H&&void 0!==H&&(i.apisecret=H),_){Z[o]=function(n){if("success"!==n.janus)return t.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);var o=n.data.id;t.log("Created handle: "+o);var i={session:Q,plugin:r,id:o,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return r},getVolume:function(){return w(o)},isAudioMuted:function(){return S(o,!1)},muteAudio:function(){return T(o,!1,!0)},unmuteAudio:function(){return T(o,!1,!1)},isVideoMuted:function(){return S(o,!0)},muteVideo:function(){return T(o,!0,!0)},unmuteVideo:function(){return T(o,!0,!1)},getBitrate:function(){return k(o)},send:function(e){c(o,e)},data:function(e){d(o,e)},dtmf:function(e){f(o,e)},consentDialog:e.consentDialog,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){g(o,e)},createAnswer:function(e){g(o,e)},handleRemoteJsep:function(e){m(o,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){D(o,!0===e)},detach:function(e){v(o,e)}};K[o]=i,e.success(i)},i.session_id=Y;var a=JSON.stringify(i);return P.send(a),void t.debug("JSNT: ",a)}t.ajax({type:"POST",url:J+"/"+Y,cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(n){if(t.debug(n),"success"!==n.janus)return t.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);var o=n.data.id;t.log("Created handle: "+o);var i={session:Q,plugin:r,id:o,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return r},getVolume:function(){return w(o)},isAudioMuted:function(){return S(o,!1)},muteAudio:function(){return T(o,!1,!0)},unmuteAudio:function(){return T(o,!1,!1)},isVideoMuted:function(){return S(o,!0)},muteVideo:function(){return T(o,!0,!0)},unmuteVideo:function(){return T(o,!0,!1)},getBitrate:function(){return k(o)},send:function(e){c(o,e)},data:function(e){d(o,e)},dtmf:function(e){f(o,e)},consentDialog:e.consentDialog,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){g(o,e)},createAnswer:function(e){g(o,e)},handleRemoteJsep:function(e){m(o,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){D(o,!0===e)},detach:function(e){v(o,e)}};K[o]=i,e.success(i)},error:function(e,n,r){t.error(n+": "+r)},dataType:"json"})}function c(e,r){if(r=r||{},r.success="function"==typeof r.success?r.success:t.noop,r.error="function"==typeof r.error?r.error:t.noop,!z)return t.warn("Is the gateway down? (connected=false)"),void r.error("Is the gateway down? (connected=false)");var o=r.message,i=r.jsep,a=n(12),s={janus:"message",body:o,transaction:a};if(null!==B&&void 0!==B&&(s.token=B),null!==H&&void 0!==H&&(s.apisecret=H),null!==i&&void 0!==i&&(s.jsep=i),t.debug("Sending message to plugin (handle="+e+"):"),t.debug("JSNT: ",JSON.stringify(s)),_)return s.session_id=Y,s.handle_id=e,Z[a]=function(e){if(t.debug("Message sent!"),"success"===e.janus){var n=e.plugindata;if(void 0===n||null===n)return t.warn("Request succeeded, but missing plugindata..."),void r.success();t.log("Synchronous transaction successful ("+n.plugin+")");var o=n.data;return void r.success(o)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(t.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(t.error("Unknown error"),r.error("Unknown error")));r.success()},void P.send(JSON.stringify(s));t.ajax({type:"POST",url:J+"/"+Y+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(s),success:function(e){if(t.debug("Message sent!"),t.debug(e),"success"===e.janus){var n=e.plugindata;if(void 0===n||null===n)return t.warn("Request succeeded, but missing plugindata..."),void r.success();t.log("Synchronous transaction successful ("+n.plugin+")");var o=n.data;return t.debug(o),void r.success(o)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(t.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(t.error("Unknown error"),r.error("Unknown error")));r.success()},error:function(e,n,o){t.error(n+": "+o),r.error(n+": "+o)},dataType:"json"})}function l(e,r){if(!z)return void t.warn("Is the gateway down? (connected=false)");var o={janus:"trickle",candidate:r,transaction:n(12)};if(null!==B&&void 0!==B&&(o.token=B),null!==H&&void 0!==H&&(o.apisecret=H),t.vdebug("Sending trickle candidate (handle="+e+"):"),t.vdebug("JSNT: ",JSON.stringify(o)),_)return o.session_id=Y,o.handle_id=e,void P.send(JSON.stringify(o));t.ajax({type:"POST",url:J+"/"+Y+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(o),success:function(e){if(t.vdebug("Candidate sent!"),t.vdebug(e),"ack"!==e.janus)return void t.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,n,r){t.error(n+": "+r)},dataType:"json"})}function d(e,n){n=n||{},n.success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:t.noop;var r=K[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return t.warn("Invalid handle"),void n.error("Invalid handle");var o=r.webrtcStuff,i=n.text;if(null===i||void 0===i)return t.warn("Invalid text"),void n.error("Invalid text");t.log("Sending string on data channel: "+i),o.dataChannel.send(i),n.success()}function f(e,n){n=n||{},n.success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:t.noop;var r=K[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return t.warn("Invalid handle"),void n.error("Invalid handle");var o=r.webrtcStuff;if(null===o.dtmfSender||void 0===o.dtmfSender){if(void 0!==o.myStream&&null!==o.myStream){var i=o.myStream.getAudioTracks();if(null!==i&&void 0!==i&&i.length>0){var a=i[0];o.dtmfSender=o.pc.createDTMFSender(a),t.log("Created DTMF Sender"),o.dtmfSender.ontonechange=function(e){t.debug("Sent DTMF tone: "+e.tone)}}}if(null===o.dtmfSender||void 0===o.dtmfSender)return t.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration")}var s=n.dtmf;if(null===s||void 0===s)return t.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");var u=s.tones;if(null===u||void 0===u)return t.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");var c=s.duration;null!==c&&void 0!==c||(c=500);var l=s.gap;null!==l&&void 0!==l||(l=50),t.debug("Sending DTMF string "+u+" (duration "+c+"ms, gap "+l+"ms)"),o.dtmfSender.insertDTMF(u,c,l)}function v(e,r){r=r||{},r.success="function"==typeof r.success?r.success:t.noop,r.error="function"==typeof r.error?r.error:t.noop;var o=!0;if(void 0!==r.asyncRequest&&null!==r.asyncRequest&&(o=!0===r.asyncRequest),t.log("Destroying handle "+e+" (sync="+o+")"),D(e),!z)return t.warn("Is the gateway down? (connected=false)"),void r.error("Is the gateway down? (connected=false)");var i={janus:"detach",transaction:n(12)};if(null!==B&&void 0!==B&&(i.token=B),null!==H&&void 0!==H&&(i.apisecret=H),_){i.session_id=Y,i.handle_id=e;var a=JSON.stringify(i);return P.send(a),t.debug("JSNT: ",a),delete K[e],void r.success()}t.ajax({type:"POST",url:J+"/"+Y+"/"+e,async:o,cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(n){t.log("Destroyed handle:"),t.debug(n),"success"!==n.janus&&t.error("Ooops: "+n.error.code+" "+n.error.reason),delete K[e],r.success()},error:function(n,o,i){t.error(o+": "+i),delete K[e],r.success()},dataType:"json"})}function p(e,n,r,o,i){var a=K[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return t.warn("Invalid handle"),void o.error("Invalid handle");var s=a.webrtcStuff;t.debug("streamsDone:",i),s.myStream=i;var u={iceServers:U,iceTransportPolicy:q},c={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===W&&c.optional.push({googIPv6:!0}),"edge"===adapter.browserDetails.browser&&(u.bundlePolicy="max-bundle"),t.log("Creating PeerConnection"),t.debug(c),s.pc=new RTCPeerConnection(u,c),t.debug(s.pc),s.pc.getStats&&(s.volume.value=0,s.bitrate.value="0 kbits/sec"),t.log("Preparing local SDP and gathering candidates (trickle="+s.trickle+")"),s.pc.onicecandidate=function(n){if(null==n.candidate||"edge"===adapter.browserDetails.browser&&n.candidate.candidate.indexOf("endOfCandidates")>0)t.log("End of candidates."),s.iceDone=!0,!0===s.trickle?l(e,{completed:!0}):y(e,o);else{var r={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};!0===s.trickle&&l(e,r)}},null!==i&&void 0!==i&&(t.log("Adding local stream"),s.pc.addStream(i),a.onlocalstream(i)),s.pc.onaddstream=function(e){t.log("Handling Remote Stream"),t.debug(e),s.remoteStream=e,a.onremotestream(e.stream)},x(r)){t.log("Creating data channel");var d=function(e){t.log("Received message on data channel: "+e.data),a.ondata(e.data)},f=function(){var e=null!==s.dataChannel?s.dataChannel.readyState:"null";t.log("State change on data channel: "+e),"open"===e&&a.ondataopen()},v=function(e){t.error("Got error on data channel:",e)};s.dataChannel=s.pc.createDataChannel("JanusDataChannel",{ordered:!1}),s.dataChannel.onmessage=d,s.dataChannel.onopen=f,s.dataChannel.onclose=f,s.dataChannel.onerror=v}null===n||void 0===n?b(e,r,o):("edge"===adapter.browserDetails.browser&&(n.sdp+="a=end-of-candidates\r\n"),s.pc.setRemoteDescription(new RTCSessionDescription(n),function(){t.log("Remote description accepted!"),h(e,r,o)},o.error))}function g(e,n){function r(r,t){s.consentDialog(!1),r?n.error({code:r.code,name:r.name,message:r.message}):p(e,i,a,n,t)}function o(e,n){t.log("Adding media constraint (screen capture)"),t.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){n(null,e)}).catch(function(e){s.consentDialog(!1),n(e)})}n=n||{},n.success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:C;var i=n.jsep,a=n.media;console.info("media: ",a);var s=K[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return t.warn("Invalid handle"),void n.error("Invalid handle");var u=s.webrtcStuff;if(void 0!==u.pc&&null!==u.pc)return t.log("Updating existing media session"),void(null===i||void 0===i?b(e,a,n):("edge"===adapter.browserDetails.browser&&(i.sdp+="a=end-of-candidates\r\n"),u.pc.setRemoteDescription(new RTCSessionDescription(i),function(){t.log("Remote description accepted!"),h(e,a,n)},n.error)));if(null!==n.stream&&void 0!==n.stream){var c=n.stream;return t.log("MediaStream provided by the application"),t.debug(c),u.streamExternal=!0,void p(e,i,a,n,c)}if(u.trickle=M(n.trickle),I(a)||A(a)){var l={mandatory:{},optional:[]};s.consentDialog(!0);var d=I(a);!0===d&&void 0!=a&&null!=a&&"object"==typeof a.audio&&(d=a.audio);var f=A(a);if(!0===f&&void 0!=a&&null!=a)if(a.video&&"screen"!=a.video&&"window"!=a.video){var v=0,g=0,m=0;if("lowres"===a.video)g=240,m=240,v=320;else if("lowres-16:9"===a.video)g=180,m=180,v=320;else if("hires"===a.video||"hires-16:9"===a.video){if(g=720,m=720,v=1280,navigator.mozGetUserMedia){var y=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);y<38&&(t.warn(a.video+" unsupported, falling back to stdres (old Firefox)"),g=480,m=480,v=640)}}else"stdres"===a.video?(g=480,m=480,v=640):"stdres-16:9"===a.video?(g=360,m=360,v=640):(t.log("Default video setting ("+a.video+") is stdres 4:3"),g=480,m=480,v=640);if(t.log("Adding media constraint "+a.video),navigator.mozGetUserMedia){var y=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);f=y<38?{require:["height","width"],height:{max:m,min:g},width:{max:v,min:v}}:{height:{ideal:g},width:{ideal:v}}}else f={mandatory:{maxHeight:m,minHeight:g,maxWidth:v,minWidth:v},optional:[]};"object"==typeof a.video&&(f=a.video),t.debug(f)}else if("screen"===a.video||"window"===a.video){if("https:"!==window.location.protocol)return t.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),s.consentDialog(!1),void n.error("Screen sharing only works on HTTPS, try the https:// version of this page");var w={};if("chrome"===adapter.browserDetails.browser){var S=adapter.browserDetails.version,T=33;if(window.navigator.userAgent.match("Linux")&&(T=35),S>=26&&S<=T)l={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}},audio:I(a)},o(l,r);else{var k=window.setTimeout(function(){return R=new Error("NavigatorUserMediaError"),R.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',s.consentDialog(!1),n.error(R)},1e3);w[k]=[r,null],window.postMessage({type:"janusGetScreen",id:k},"*")}}else if(window.navigator.userAgent.match("Firefox")){var D=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);if(!(D>=33)){var R=new Error("NavigatorUserMediaError");return R.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",s.consentDialog(!1),void n.error(R)}l={video:{mozMediaSource:a.video,mediaSource:a.video},audio:I(a)},o(l,function(e,n){if(r(e,n),!e)var t=n.currentTime,o=window.setInterval(function(){n||window.clearInterval(o),n.currentTime==t&&(window.clearInterval(o),n.onended&&n.onended()),t=n.currentTime},500)})}return void window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("janusGotScreen"==e.data.type&&w[e.data.id]){var r=w[e.data.id],t=r[0];if(delete w[e.data.id],""===e.data.sourceId){var i=new Error("NavigatorUserMediaError");i.name="You cancelled the request for permission, giving up...",s.consentDialog(!1),n.error(i)}else l={audio:I(a),video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},l.video.mandatory.chromeMediaSourceId=e.data.sourceId,o(l,t)}else"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})}null!==a&&void 0!==a&&"screen"===a.video||navigator.mediaDevices.enumerateDevices().then(function(r){var o=r.some(function(e){return"audioinput"===e.kind}),u=r.some(function(e){return"videoinput"===e.kind}),c=I(a),l=A(a),v=j(a),g=O(a);if(c||l||v||g){var m=!!c&&o,b=!!l&&u;if(!m&&!b)return s.consentDialog(!1),n.error("No capture device found"),!1;if(!m&&v)return s.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!b&&g)return s.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var h=void 0===n.echoCancellation||{optional:[{echoCancellation:n.echoCancellation}]},y={audio:!!o&&(!!d&&h),video:!!u&&f};t.debug("getUserMedia constraints: ",y),navigator.mediaDevices.getUserMedia(y).then(function(r){s.consentDialog(!1),p(e,i,a,n,r)}).catch(function(e){s.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){s.consentDialog(!1),n.error("enumerateDevices error",e)})}else p(e,i,a,n)}function m(e,n){n=n||{},n.success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:C;var r=n.jsep,o=K[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return t.warn("Invalid handle"),void n.error("Invalid handle");var i=o.webrtcStuff;if(void 0!==r&&null!==r){if(null===i.pc)return t.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");"edge"===adapter.browserDetails.browser&&(r.sdp+="a=end-of-candidates\r\n"),i.pc.setRemoteDescription(new RTCSessionDescription(r),function(){t.log("Remote description accepted!"),n.success()},n.error)}else n.error("Invalid JSEP")}function b(e,n,r){r=r||{},r.success="function"==typeof r.success?r.success:t.noop,r.error="function"==typeof r.error?r.error:t.noop;var o=K[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return t.warn("Invalid handle"),void r.error("Invalid handle");var i=o.webrtcStuff;t.log("Creating offer (iceDone="+i.iceDone+")");var a=null;a="firefox"==adapter.browserDetails.browser||"edge"==adapter.browserDetails.browser?{offerToReceiveAudio:R(n),
offerToReceiveVideo:E(n)}:{mandatory:{OfferToReceiveAudio:R(n),OfferToReceiveVideo:E(n)}},t.debug(a),i.pc.createOffer(function(e){if(t.debug(e),null!==i.mySdp&&void 0!==i.mySdp||(t.log("Setting local description"),i.mySdp=e.sdp,i.pc.setLocalDescription(e)),!i.iceDone&&!i.trickle)return void t.log("Waiting for all candidates...");if(i.sdpSent)return void t.log("Offer already sent, not sending it again");t.log("Offer ready"),t.debug(r),i.sdpSent=!0;var n={type:e.type,sdp:e.sdp};r.success(n)},r.error,a)}function h(e,n,r){r=r||{},r.success="function"==typeof r.success?r.success:t.noop,r.error="function"==typeof r.error?r.error:t.noop;var o=K[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return t.warn("Invalid handle"),void r.error("Invalid handle");var i=o.webrtcStuff;t.log("Creating answer (iceDone="+i.iceDone+")");var a=null;a="firefox"==adapter.browserDetails.browser||"edge"==adapter.browserDetails.browser?{offerToReceiveAudio:R(n),offerToReceiveVideo:E(n)}:{mandatory:{OfferToReceiveAudio:R(n),OfferToReceiveVideo:E(n)}},t.debug(a),i.pc.createAnswer(function(e){if(t.debug(e),null!==i.mySdp&&void 0!==i.mySdp||(t.log("Setting local description"),i.mySdp=e.sdp,i.pc.setLocalDescription(e)),!i.iceDone&&!i.trickle)return void t.log("Waiting for all candidates...");if(i.sdpSent)return void t.log("Answer already sent, not sending it again");i.sdpSent=!0;var n={type:e.type,sdp:e.sdp};r.success(n)},r.error,a)}function y(e,n){n=n||{},n.success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:t.noop;var r=K[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return void t.warn("Invalid handle, not sending anything");var o=r.webrtcStuff;return t.log("Sending offer/answer SDP..."),null===o.mySdp||void 0===o.mySdp?void t.warn("Local SDP instance is invalid, not sending anything..."):(o.mySdp={type:o.pc.localDescription.type,sdp:o.pc.localDescription.sdp},o.sdpSent?void t.log("Offer/Answer SDP already sent, not sending it again"):(!1===o.trickle&&(o.mySdp.trickle=!1),t.debug(n),o.sdpSent=!0,void n.success(o.mySdp)))}function w(e){var n=K[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return t.warn("Invalid handle"),0;var r=n.webrtcStuff;return r.pc.getStats&&"chrome"==adapter.browserDetails.browser?null===r.remoteStream||void 0===r.remoteStream?(t.warn("Remote stream unavailable"),0):null===r.volume.timer||void 0===r.volume.timer?(t.log("Starting volume monitor"),r.volume.timer=setInterval(function(){r.pc.getStats(function(e){for(var n=e.result(),t=0;t<n.length;t++){var o=n[t];"ssrc"==o.type&&o.stat("audioOutputLevel")&&(r.volume.value=o.stat("audioOutputLevel"))}})},200),0):r.volume.value:(t.log("Getting the remote volume unsupported by browser"),0)}function S(e,n){var r=K[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return t.warn("Invalid handle"),!0;var o=r.webrtcStuff;return null===o.pc||void 0===o.pc?(t.warn("Invalid PeerConnection"),!0):void 0===o.myStream||null===o.myStream?(t.warn("Invalid local MediaStream"),!0):n?null===o.myStream.getVideoTracks()||void 0===o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length?(t.warn("No video track"),!0):!o.myStream.getVideoTracks()[0].enabled:null===o.myStream.getAudioTracks()||void 0===o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length?(t.warn("No audio track"),!0):!o.myStream.getAudioTracks()[0].enabled}function T(e,n,r){var o=K[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return t.warn("Invalid handle"),!1;var i=o.webrtcStuff;return null===i.pc||void 0===i.pc?(t.warn("Invalid PeerConnection"),!1):void 0===i.myStream||null===i.myStream?(t.warn("Invalid local MediaStream"),!1):n?null===i.myStream.getVideoTracks()||void 0===i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length?(t.warn("No video track"),!1):(i.myStream.getVideoTracks()[0].enabled=!r,!0):null===i.myStream.getAudioTracks()||void 0===i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length?(t.warn("No audio track"),!1):(i.myStream.getAudioTracks()[0].enabled=!r,!0)}function k(e){var n=K[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return t.warn("Invalid handle"),"Invalid handle";var r=n.webrtcStuff;if(null===r.pc||void 0===r.pc)return"Invalid PeerConnection";if(r.pc.getStats&&"chrome"==adapter.browserDetails.browser)return null===r.remoteStream||void 0===r.remoteStream?(t.warn("Remote stream unavailable"),"Remote stream unavailable"):null===r.bitrate.timer||void 0===r.bitrate.timer?(t.log("Starting bitrate timer (Chrome)"),r.bitrate.timer=setInterval(function(){r.pc.getStats(function(e){for(var n=e.result(),t=0;t<n.length;t++){var o=n[t];if("ssrc"==o.type&&o.stat("googFrameHeightReceived"))if(r.bitrate.bsnow=o.stat("bytesReceived"),r.bitrate.tsnow=o.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var i=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/(r.bitrate.tsnow-r.bitrate.tsbefore));r.bitrate.value=i+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}}})},1e3),"0 kbits/sec"):r.bitrate.value;if(r.pc.getStats&&"firefox"==adapter.browserDetails.browser){if(null===r.remoteStream||void 0===r.remoteStream||null===r.remoteStream.stream||void 0===r.remoteStream.stream)return t.warn("Remote stream unavailable"),"Remote stream unavailable";var o=r.remoteStream.stream.getVideoTracks();return null===o||void 0===o||o.length<1?(t.warn("No video track"),"No video track"):null===r.bitrate.timer||void 0===r.bitrate.timer?(t.log("Starting bitrate timer (Firefox)"),r.bitrate.timer=setInterval(function(){var e=function(e){if(null===e||void 0===e||null==e.inbound_rtp_video_1||null==e.inbound_rtp_video_1)return void(r.bitrate.value="Missing inbound_rtp_video_1");if(r.bitrate.bsnow=e.inbound_rtp_video_1.bytesReceived,r.bitrate.tsnow=e.inbound_rtp_video_1.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var n=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/(r.bitrate.tsnow-r.bitrate.tsbefore));r.bitrate.value=n+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}};r.pc.getStats(o[0],function(n){e(n)},e)},1e3),"0 kbits/sec"):r.bitrate.value}return t.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function C(e){t.error("WebRTC error:",e)}function D(e,r){t.log("Cleaning WebRTC stuff, handleId: ",e);var o=K[e];if(null===o||void 0===o)return void t.log("Nothing to clean for handleId: ",e);var i=o.webrtcStuff;if(null!==i&&void 0!==i){if(!0===r){var a={janus:"hangup",transaction:n(12)};null!==B&&void 0!==B&&(a.token=B),null!==H&&void 0!==H&&(a.apisecret=H),t.debug("Sending hangup request (handle="+e+"):"),t.debug(a),_?(a.session_id=Y,a.handle_id=e,P.send(JSON.stringify(a))):$.ajax({type:"POST",url:J+"/"+Y+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(a),dataType:"json"})}i.remoteStream=null,i.volume.timer&&clearInterval(i.volume.timer),i.volume.value=null,i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null;try{i.streamExternal||null===i.myStream||void 0===i.myStream||(t.log("Stopping local stream"),i.myStream.stop())}catch(e){}try{if(!i.streamExternal&&null!==i.myStream&&void 0!==i.myStream){t.log("Stopping local stream tracks");var s=i.myStream.getTracks();for(var u in s){var c=s[u];t.log(c),null!==c&&void 0!==c&&c.stop()}}}catch(e){}i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(e){}i.pc=null,i.mySdp=null,i.iceDone=!1,i.sdpSent=!1,i.dataChannel=null,i.dtmfSender=null}o.oncleanup()}function I(e){return t.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function j(e){return t.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function R(e){return t.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function A(e){return t.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function O(e){return t.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function E(e){return t.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function x(e){return t.debug("isDataEnabled:",e),"edge"==adapter.browserDetails.browser?(t.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function M(e){return t.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}if(void 0===t.initDone)return e.error("Library not initialized"),{};if(!t.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(t.log("Library initialized: "+t.initDone),e=e||{},e.success="function"==typeof e.success?e.success:t.noop,e.error="function"==typeof e.error?e.error:t.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:t.noop,null===e.server||void 0===e.server)return e.error("Invalid gateway url"),{};var _=!1,P=null,N={},F=null,L=null,V=0,J=e.server;Array.isArray(J)?(t.log("Multiple servers provided ("+J.length+"), will use the first that works"),J=null,L=e.server,t.debug(L)):0===J.indexOf("ws")?(_=!0,t.log("Using WebSockets to contact Janus: "+J)):(_=!1,t.log("Using REST API to contact Janus: "+J));var U=e.iceServers;void 0!==U&&null!==U||(U=[{urls:"stun:stun.l.google.com:19302"}]);var q=e.iceTransportPolicy,W=e.ipv6;void 0!==W&&null!==W||(W=!1);var G=null;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(G=e.max_poll_events),G<1&&(G=1);var B=null;void 0!==e.token&&null!==e.token&&(B=e.token);var H=null;void 0!==e.apisecret&&null!==e.apisecret&&(H=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var z=!1,Y=null,K={},Q=this,X=0,Z={};a(e),this.getServer=function(){return J},this.isConnected=function(){return z},this.getSessionId=function(){return Y},this.destroy=function(e){s(e)},this.attach=function(e){u(e)}}t.sessions={},t.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",t.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),e>=26&&e<=n||null!==document.getElementById("janus-extension-installed")}return!0},t.noop=function(){},t.init=function(e){function n(e,n){try{if(adapter)return t.debug(e+" already loaded, skipping"),void n()}catch(e){}var r=document.getElementsByTagName("head").item(0),o=document.createElement("script");o.type="text/javascript",o.src=e,o.onload=function(){t.log("Library "+e+" loaded"),n()},r.appendChild(o)}if(e=e||{},e.callback="function"==typeof e.callback?e.callback:t.noop,!0===t.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),t.trace=t.noop,t.debug=t.noop,t.vdebug=t.noop,t.log=t.noop,t.warn=t.noop,t.error=t.noop,!0===e.debug||"all"===e.debug)t.trace=console.trace.bind(console),t.debug=console.debug.bind(console),t.vdebug=console.debug.bind(console),t.log=console.log.bind(console),t.warn=console.warn.bind(console),t.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var r in e.debug){var o=e.debug[r];switch(o){case"trace":t.trace=console.trace.bind(console);break;case"debug":t.debug=console.debug.bind(console);break;case"vdebug":t.vdebug=console.debug.bind(console);break;case"log":t.log=console.log.bind(console);break;case"warn":t.warn=console.warn.bind(console);break;case"error":t.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+o+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}t.log("Initializing library"),t.listDevices=function(e){e="function"==typeof e?e:t.noop,navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(n){navigator.mediaDevices.enumerateDevices().then(function(r){t.debug(r),e(r);try{n.stop()}catch(e){}try{var o=n.getTracks();for(var i in o){var a=o[i];null!==a&&void 0!==a&&a.stop()}}catch(e){}})}).catch(function(n){t.error(n),e([])}):(t.warn("navigator.mediaDevices unavailable"),e([]))},t.attachMediaStream=function(e,n){if("chrome"===adapter.browserDetails.browser){adapter.browserDetails.version>=43?e.srcObject=n:void 0!==e.src?e.src=URL.createObjectURL(n):t.error("Error attaching stream to element")}else e.srcObject=n},t.reattachMediaStream=function(e,n){if("chrome"===adapter.browserDetails.browser){adapter.browserDetails.version>=43?e.srcObject=n.srcObject:void 0!==e.src&&(e.src=n.src)}else e.srcObject=n.srcObject},t.ajax=function(e){if(null!==e&&void 0!==e){if(e.success="function"==typeof e.success?e.success:t.noop,e.error="function"==typeof e.error?e.error:t.noop,null===e.url||void 0===e.url)return t.error("Missing url",e.url),void e.error(null,-1,"Missing url");e.async=null===e.async||void 0===e.async||!0===e.async,t.log(e);var n=new XMLHttpRequest;n.open(e.type,e.url,e.async),null!==e.contentType&&void 0!==e.contentType&&n.setRequestHeader("Content-type",e.contentType),e.async&&(n.onreadystatechange=function(){if(4==n.readyState)return 200!==n.status?(0===n.status&&(n.status="error"),void e.error(n,n.status,"")):void e.success(JSON.parse(n.responseText))});try{if(n.send(e.data),!e.async){if(200!==n.status)return 0===n.status&&(n.status="error"),void e.error(n,n.status,"");e.success(JSON.parse(n.responseText))}}catch(r){e.error(n,"error","")}}};var i=window.onbeforeunload;window.onbeforeunload=function(){t.log("Closing window");for(var e in t.sessions)null!==t.sessions[e]&&void 0!==t.sessions[e]&&t.sessions[e].destroyOnUnload&&(t.log("Destroying session "+e),t.sessions[e].destroy({asyncRequest:!1}));i&&"function"==typeof i&&i()},t.initDone=!0,function(r){function t(){o++,o<r.length?n(r[o],t):e.callback()}r&&Array.isArray(r)&&0!=r.length||e.callback();var o=0;n(r[o],t)}(["adapter.js"])}},t.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},n.exports=t},{}],10:[function(e,n,r){"use strict";function t(e){if(!adapter)throw"Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter";if(this.configs=e,!this.configs.server)throw"'server' parameter is mandatory.";this.configs.server.includes("http")&&(this.configs.server=this.configs.server+"/janus"),this.configs.debug||(this.configs.debug="all"),this.engine=null,this.videoRoomPlugin=null,this.isOnlyAudio=!1,this.currentDialogId=null,this.remoteFeeds=[],this.remoteFeedsAttachingInProgress=[],this.currentMidiaDeviceId=null,this.bitrateTimers=[],this.emitter=new a}var o=e("./janus.nojquery"),i=e("./qbUtils"),a=e("fbemitter").EventEmitter;t.attachMediaStream=function(e,n){o.attachMediaStream(e,n)},t.listDevices=function(e){navigator.mediaDevices.enumerateDevices().then(function(n){console.debug(n),e(n)}).catch(function(n){console.error(n),e([])})},t.listVideoinputDevices=function(e){t.listDevices(function(n){for(var r=[],t=0;t!==n.length;++t){var o=n[t];if("videoinput"===o.kind){var i=o.label||"camera "+(r.length+1),a=o.deviceId;r.push({label:i,deviceId:a})}}e(r)})},t.prototype={createSession:function(e){var n=this;o.init({debug:this.configs.debug,callback:function(){if(!o.isWebrtcSupported())return void("function"==typeof e.error&&e.error("Your browser does not support WebRTC, so you can't use this functionality."));n.engine=new o({server:n.configs.server,iceServers:n.configs.iceServers,success:function(){"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(n){"function"==typeof e.error&&i.safeCallbackCall(e.error,n)},destroyed:function(){"function"==typeof e.destroyed&&i.safeCallbackCall(e.destroyed)}})}})},getSessionId:function(){return this.engine?this.engine.getSessionId():null},destroySession:function(e){var n=this;this.engine.destroy({success:function(){n.engine=null,"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(n){"function"==typeof e.error&&i.safeCallbackCall(e.error,n)}})},attachVideoConferencingPlugin:function(e,n,r){var t=this,o=null;this.engine.attach({plugin:"janus.plugin.videoroom",success:function(a){if(e){o=a,o.userId=n,t.remoteFeedsAttachingInProgress[n]=o;var s={request:"join",room:t.currentDialogId,ptype:"listener",feed:n};o.send({message:s})}else t.videoRoomPlugin=a;"function"==typeof r.success&&i.safeCallbackCall(r.success)},error:function(e){"function"==typeof r.error&&i.safeCallbackCall(r.error,i.wrapError(e))},consentDialog:function(e){"function"==typeof r.consentDialog&&i.safeCallbackCall(r.consentDialog,e)},mediaState:function(e,n){"function"==typeof r.mediaState&&i.safeCallbackCall(r.mediaState,e,n)},webrtcState:function(e){"function"==typeof r.webrtcState&&i.safeCallbackCall(r.webrtcState,e)},slowLink:function(e,n){"function"==typeof r.slowLink&&i.safeCallbackCall(r.slowLink,e,n)},onmessage:function(n,o){var a=n.videoroom;if(e){if(a)if("attached"===a){var s=n.id;t.remoteFeeds[s]=t.remoteFeedsAttachingInProgress[s],t.remoteFeedsAttachingInProgress[s]=null}else n.error&&"function"==typeof r.error&&i.safeCallbackCall(r.error,i.wrapError(n.error));if(o){var s=n.id;t.createAnswer(t.remoteFeeds[s],o,{success:function(){},error:function(e){"function"==typeof r.error&&i.safeCallbackCall(r.error,i.wrapError(e))}})}}else{if(a)if("joined"===a)t.createOffer(!0,!t.isOnlyAudio,null,{success:function(){if(n.publishers){var e=n.publishers;for(var r in e){var o=e[r].id,i=e[r].display;t.emitter.emit("participantjoined",o,i)}}},error:function(e){"function"==typeof r.error&&i.safeCallbackCall(r.error,i.wrapError(e))}});else if("event"===a)if(n.publishers){var u=n.publishers;for(var c in u){var l=u[c].id,d=u[c].display;t.emitter.emit("participantjoined",l,d)}}else if(n.leaving){var s=n.leaving,f=t.remoteFeeds[s];f&&(f.detach(),t.remoteFeeds[s]=null,t.emitter.emit("participantleft",s,null))}else if(n.unpublished){var s=n.unpublished;if("ok"!=s){var f=t.remoteFeeds[s];f&&(f.detach(),t.remoteFeeds[s]=null,t.emitter.emit("participantleft",s,null))}}else n.error&&"function"==typeof r.error&&i.safeCallbackCall(r.error,i.wrapError(n.error));o&&t.videoRoomPlugin.handleRemoteJsep({jsep:o})}},onlocalstream:function(e){t.emitter.emit("localstream",e)},onremotestream:function(e){o.stream=e,t.emitter.emit("remotestream",e,o.userId)},oncleanup:function(){console.info("ON CLEANUP"),"function"==typeof r.oncleanup&&i.safeCallbackCall(r.oncleanup)},detached:function(){}})},getPluginId:function(){return this.videoRoomPlugin?this.videoRoomPlugin.getId():null},detachVideoConferencingPlugin:function(e){var n=this;this.videoRoomPlugin.detach({success:function(){n.videoRoomPlugin=null,n.remoteFeeds=[],n.currentMidiaDeviceId=null,"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(n){"function"==typeof e.error&&i.safeCallbackCall(e.error,n)}})},join:function(e,n,r,t){var o=this;if("boolean"!=typeof r)throw"'isOnlyAudio' parameter can be of type 'boolean' only.";o.isOnlyAudio=r;var a={request:"join",room:e,ptype:"publisher",id:n};this.videoRoomPlugin.send({message:a,success:function(r){o.currentDialogId=e,o.currentUserId=n,"function"==typeof t.success&&i.safeCallbackCall(t.success)},error:function(e){"function"==typeof t.error&&i.safeCallbackCall(t.error,e)}})},leave:function(e){var n={request:"leave",room:this.currentDialogId,id:this.currentUserId};this.videoRoomPlugin.send({message:n,success:function(){"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(n){"function"==typeof e.error&&i.safeCallbackCall(e.error,n)}}),this.currentDialogId=null,this.currentUserId=null},listOnlineParticipants:function(e,n){var r={request:"listparticipants",room:e};this.videoRoomPlugin.send({message:r,success:function(e){var r=[];e&&(r=e.participants),"function"==typeof n.success&&i.safeCallbackCall(n.success,r)},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,e)}})},toggleAudioMute:function(){return this.videoRoomPlugin.isAudioMuted()?this.videoRoomPlugin.unmuteAudio():this.videoRoomPlugin.muteAudio(),this.videoRoomPlugin.isAudioMuted()},isAudioMuted:function(){return this.videoRoomPlugin.isAudioMuted()},toggleRemoteAudioMute:function(e){var n=this.remoteFeeds[e];if(!n)return!1;var r=n.stream.getAudioTracks();if(r&&r.length>0){for(var t=0;t<r.length;++t)r[t].enabled=!r[t].enabled;return!r[0].enabled}return!1},isRemoteAudioMuted:function(e){var n=this.remoteFeeds[e];if(!n)return!1;var r=n.stream.getAudioTracks();return!!(r&&r.length>0)&&!r[0].enabled},toggleVideoMute:function(){return this.videoRoomPlugin.isVideoMuted()?this.videoRoomPlugin.unmuteVideo():this.videoRoomPlugin.muteVideo(),this.videoRoomPlugin.isVideoMuted()},isVideoMuted:function(){return this.videoRoomPlugin.isVideoMuted()},toggleRemoteVideoMute:function(e){var n=this.remoteFeeds[e];if(!n)return!1;var r=n.stream.getVideoTracks();if(r&&r.length>0){for(var t=0;t<r.length;++t)r[t].enabled=!r[t].enabled;return!r[0].enabled}return!1},isRemoteVideoMuted:function(e){var n=this.remoteFeeds[e];if(!n)return!1;var r=n.stream.getVideoTracks();return!!(r&&r.length>0)&&!r[0].enabled},switchVideoinput:function(e,n){if(this.videoRoomPlugin||"function"==typeof n.error&&i.safeCallbackCall(n.error,"No active stream"),this.isOnlyAudio)throw"Can't switch video input in audio only call.";this.videoRoomPlugin.hangup(!0),this.currentMidiaDeviceId=null;var r={audio:!0,video:{deviceId:{exact:e}}},t=this;console.info("getUserMedia constraints: ",r),navigator.mediaDevices.getUserMedia(r).then(function(r){console.info("GOT new stream"),t.currentMidiaDeviceId=e,setTimeout(function(){t.createOffer(!0,!t.isOnlyAudio,r,{success:function(){"function"==typeof n.success&&i.safeCallbackCall(n.success)},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,e)}})},1e3)}).catch(function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,e)})},createOffer:function(e,n,r,t){var o,i=this;o=r?{stream:r}:{media:{audioRecv:!1,videoRecv:!1,audioSend:e,videoSend:n}},"undefined"!=i.configs.echoCancellation&&(o.echoCancellation=i.configs.echoCancellation),o.success=function(r){var o={request:"configure",audio:e,video:n};i.videoRoomPlugin.send({message:o,jsep:r}),"function"==typeof t.success&&t.success()},o.error=function(n){e?i.createOffer(!1,!1,null,t):"function"==typeof t.error&&t.error(n)},this.videoRoomPlugin.createOffer(o)},createAnswer:function(e,n,r){var t=this;e.createAnswer({jsep:n,media:{audioSend:!1,videoSend:!1},success:function(n){var o={request:"start",room:t.currentDialogId};e.send({message:o,jsep:n}),"function"==typeof r.success&&i.safeCallbackCall(r.success)},error:function(e){"function"==typeof r.error&&i.safeCallbackCall(r.error,e)}})},showBitrate:function(e,n){var r=this.remoteFeeds[e];"chrome"!==adapter.browserDetails.browser&&"firefox"!==adapter.browserDetails.browser||(this.bitrateTimers[e]=setInterval(function(){var e=r.getBitrate();n.text(e)},1e3))},hideBitrate:function(e,n){this.bitrateTimers[e]&&clearInterval(this.bitrateTimers[e]),this.bitrateTimers[e]=null,n.text=null},on:function(e,n){this.emitter.addListener(e,n)},removeAllListeners:function(e){e?this.emitter.removeAllListeners(e):this.emitter.removeAllListeners()}},n.exports=t},{"./janus.nojquery":9,"./qbUtils":11,fbemitter:1}],11:[function(e,n,r){"use strict";var t={safeCallbackCall:function(){for(var e,n=arguments[0].toString(),r=n.split("(")[0].split(" ")[1],t=[],o=0;o<arguments.length;o++)t.push(arguments[o]);e=t.shift();try{e.apply(null,t)}catch(e){""===r?console.error("Error: "+e):console.error("Error in listener "+r+": "+e)}},wrapError:function(e){return"string"==typeof e?{error_code:400,error:e}:e},getUUID:function(){var e=window.navigator,n=window.screen,r=e.mimeTypes.length;return r+=e.userAgent.replace(/\D+/g,""),r+=e.plugins.length,r+=n.height||"",r+=n.width||"",r+=n.pixelDepth||""}};n.exports=t},{}]},{},[10])(10)});